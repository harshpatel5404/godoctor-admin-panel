<script>
window.addEventListener('load', function() {
    const loader = document.getElementById('page-loader');
    if (loader) {
        loader.style.transition = 'opacity 0.5s ease';
        loader.style.opacity = 0;
        setTimeout(() => loader.style.display = 'none', 500);
    }
});

$(document).ready(function (){

    $(document).on('click', '#login_admin', function(){
        
        $('input[name=udetail]').val('9999999999')
        $('input[name=password]').val('123')
    })
    
    $(document).on('click', '#login_sitter', function(){
       
        $('input[name=udetail]').val('meera.sharma@cscodetech.com')
        $('input[name=password]').val('123')
    })
    
    $(document).on('click', '#login_lab', function(){
       
        $('input[name=udetail]').val('9988776655');
        $('input[name=password]').val('123');
    })
    
    $(document).on('click', '#login_role', function(){
        
        $('input[name=udetail]').val('Role@cscodetech.com');
        $('input[name=password]').val('123');
    })

    $(document).on("click", ".lang", function(){
        let lan = $(this).attr("data-value")
        const base_url = window.location.origin;
        $.ajax({
            url: base_url + '/language',
            type: 'POST',
            dataType: 'JSON',
            data: {lan},
            success: function (res){
                location.reload()
            }
        });
    })

    if ($("#hidden_lang").val() == 'in') {
        $("#in").addClass("bg-primary")
    } else if ($("#hidden_lang").val() == 'de') {
        $("#de").addClass("bg-primary")
    } else if ($("#hidden_lang").val() == 'en') {
        $("#en").addClass("bg-primary")
    } else if ($("#hidden_lang").val() == 'pt') {
        $("#pt").addClass("bg-primary")
    } else if ($("#hidden_lang").val() == 'es') {
        $("#es").addClass("bg-primary")
    } else if ($("#hidden_lang").val() == 'fr') {
        $("#fr").addClass("bg-primary")
    } else if ($("#hidden_lang").val() == 'cn') {
        $("#cn").addClass("bg-primary")
    } else if ($("#hidden_lang").val() == 'ae') {
        $("#ae").addClass("bg-primary")
        $("html").attr("dir", "rtl")
    }

    $(document).on('click', '#cus_sign_btn', function(){
        let image = $("#cus_pro_image").val();
        let name = $("#customet_name").val();
        let email = $("#customet_email").val();
        let country = $("#customet_code").val();
        let phone = $("#customet_number").val();
        let password = $("#customet_pass").val();

        if (image == "" || name == "" || email == "" || country == null || phone == "" || password == "") {
            $("#customer_details_error").removeClass('d-none');
        } else {
            $("#customer_details_error").addClass('d-none');
            $("#customer_email_error, #customer_phoneno_error").addClass('d-none');
            
            const base_url = window.location.origin;
            
            $.ajax({
                url: base_url + '/customer/signup_ajex',
                type: 'POST',
                dataType: 'JSON',
                data: {country, phone, email},
                success: function (res){
                    if (res.pcheck == 1) $("#customer_phoneno_error").removeClass('d-none')
                    if (res.emailc == 1) $("#customer_email_error").removeClass('d-none')

                    if(res.pcheck == 0 && res.emailc == 0) {
                        $("#customer_phoneno_error").addClass('d-none')
                        $("#customer_email_error").addClass('d-none')
                        $("#customer_signup_form").submit();
                    }
                }
            });
        }
    })

    $(document).on('click', '#edit_cus_sign_btn', function(){
        let email = $('#edit_cus_email').val();
        let country = $('#edit_cus_code').val();
        let old_ccode = $('#edit_ccode').val();
        let phone = $('#edit_cus_phone').val();
        let old_phone = $('#edit_phone').val();
        
        if ($('#edit_cus_name').val() != '' && $('#edit_cus_email').val() != '' && $('#edit_cus_code').val() != null && $('#edit_cus_phone').val() != '') {
            $("#edit_details_error").addClass('d-none');
            const base_url = window.location.origin;
            
            let nenail = $("#edit_cus_email").val() != $("#edit_email").val() ? $("#edit_cus_email").val() : '';
            let sccode = $("#edit_cus_code").val() != $("#edit_ccode").val() || $("#edit_cus_phone").val() != $("#edit_phone").val() ? $("#edit_cus_code").val() : '';
            let sphone = $("#edit_cus_code").val() != $("#edit_ccode").val() || $("#edit_cus_phone").val() != $("#edit_phone").val() ? $("#edit_cus_phone").val() : '';

            if (nenail != '' || sccode != '' || sphone != '') {
                $.ajax({
                    url: base_url + '/customer/edit_customer_ajax',
                    type: 'POST',
                    dataType: 'JSON',
                    data: {nenail, sccode, sphone},
                    success: function (res){
                        if (res.pcheck == 1) $("#edit_phone_error").removeClass('d-none')
                        if (res.emailc == 1) $("#edit_email_error").removeClass('d-none')
    
                        if(res.pcheck == 0 && res.emailc == 0) {
                            $("#edit_phone_error").addClass('d-none')
                            $("#edit_email_error").addClass('d-none')
                            $("#edit_signup_form").submit();
                        }
                    }
                });
            } else $("#edit_signup_form").submit(); 
            
        } else  $("#edit_details_error").removeClass('d-none');
    });

    $(document).on("click", "#add_hospital_btn", function(){
        let check = 0
        $(".checkaddhos").each(function(){
            if($(this).val() == "" || $(this).val() == null) check += 1;
        });

        if (check != 0) $("#detail_error").removeClass("d-none");
        else {
            $("#detail_error").addClass("d-none");
            const base_url = window.location.origin;
            $.ajax({
                url: base_url + '/hospital/check_hospital_detail',
                type: 'POST',
                dataType: 'JSON',
                data: {email: $("#add_hos_email").val(), country_code: $("#add_hos_phonecode").val(), phone: $("#add_hos_phone").val(), lat: $("#location_latitude").val(), lon: $("#location_longitude").val()},
                success: function (res){
                    if (res.check_email == false ) $("#detail_email_error").removeClass("d-none");
                    if (res.check_mobileno == false ) $("#detail_phone_error").removeClass("d-none");
                    if (res.zonec == false ) $("#detail_zone_error").removeClass("d-none");
                    
                    if (res.check_email == true && res.check_mobileno == true && res.zonec == true) {
                        $("#detail_email_error").addClass("d-none");
                        $("#detail_phone_error").addClass("d-none");
                        $("#detail_zone_error").addClass("d-none");
                        $("#add_hospital_form").submit();
                    }
                }
            });
        }
    });
    
    $(document).on("click", "#edit_hospital_btn", function(){
        let imgcheck = 0, check = 0
        $(".img_check_p").each(function(){
            if($(this).val() == "" || $(this).val() == null) check += 1;
            imgcheck += 1
        });
        $(".checkaddhos").each(function(){
            if($(this).val() == "" || $(this).val() == null) check += 1;
        });

        let country_code = '', phone = ''
        if ($("#ehccode").val() != $("#old_hos_ccode").val() || $("#ehphone").val() != $("#old_hos_phone").val()) {
            country_code = $("#ehccode").val(), phone = $("#ehphone").val();
        }
        
        let lat = $("#edit_location_latitude").val() != $("#lod_latitude").val() || $("#edit_location_longitude").val() != $("#lod_longitude").val() ? $("#edit_location_latitude").val() : '';
        let lon = $("#edit_location_latitude").val() != $("#lod_latitude").val() || $("#edit_location_longitude").val() != $("#lod_longitude").val() ? $("#edit_location_longitude").val() : '';

        if (check != 0 || imgcheck == 0) $("#detail_error").removeClass("d-none");
        else {
            $("#detail_error").addClass("d-none");
            const base_url = window.location.origin;
            $.ajax({
                url: base_url + '/hospital/check_hospital_detail',
                type: 'POST',
                dataType: 'JSON',
                data: {email: $("#ehemail").val() != $("#old_hos_email").val() ? $("#ehemail").val() : '', country_code, phone, lat, lon},
                success: function (res){
                    if (res.check_email == false ) $("#detail_email_error").removeClass("d-none");
                    if (res.check_mobileno == false ) $("#detail_phone_error").removeClass("d-none");
                    if (res.zonec == false ) $("#detail_zone_error").removeClass("d-none");
                    
                    if (res.check_email == true && res.check_mobileno == true && res.zonec == true) {
                        $("#detail_email_error").addClass("d-none");
                        $("#detail_phone_error").addClass("d-none");
                        $("#detail_zone_error").addClass("d-none");
                        $("#edit_hospital_form").submit();
                    }
                }
            });
        }
    });

    $(document).on("click", "#add_doctor_btn", function(){
        let check = 0
        $(".docin").each(function(){
            if($(this).val() == "" || $(this).val() == null) check += 1;
        });
        
        if (check != 0) $("#detail_error").removeClass("d-none");
        else {
            $("#detail_error").addClass("d-none");
            const base_url = window.location.origin;
            $.ajax({
                url: base_url + '/doctor/check_doctor_detail',
                type: 'POST',
                dataType: 'JSON',
                data: {email: $("#doc_email").val(), country_code: $("#doc_country_code").val(), phone: $("#doc_phone").val(), lat: $("#location_latitude").val(), lon: $("#location_longitude").val()},
                success: function (res){
                    if (res.check_email == false) $("#detail_email_error").removeClass("d-none");
                    else $("#detail_email_error").addClass("d-none");

                    if (res.check_mobileno == false) $("#detail_phone_error").removeClass("d-none");
                    else $("#detail_phone_error").addClass("d-none");

                    if (res.zonec == false) $("#detail_zone_error").removeClass("d-none");
                    else  $("#detail_zone_error").addClass("d-none");
                    
                    if (res.check_email == true && res.check_mobileno == true && res.zonec == true) {
                        $("#doc_form_click").submit();
                    }
                }
            });
        }
    });

    $(document).on("click", "#edit_doctor_btn", function(){
        let check = 0
        $(".docin").each(function(){
            if($(this).val() == "" || $(this).val() == null) check += 1;
        });
        
        if (check != 0) $("#detail_error").removeClass("d-none");
        else {
            $("#detail_error").addClass("d-none");

            let email = $("#doc_email").val() != $("#old_email").val() ? $("#doc_email").val() : '';
            let country_code = $("#doc_country_code").val() != $("#old_ccode").val() || $("#doc_phone").val() != $("#old_phone").val() ? $("#doc_country_code").val() : '';
            let phone = $("#doc_country_code").val() != $("#old_ccode").val() || $("#doc_phone").val() != $("#old_phone").val() ? $("#doc_phone").val() : '';
            let lat = $("#edit_location_latitude").val() != $("#lod_latitude").val() || $("#edit_location_longitude").val() != $("#lod_longitude").val() ? $("#edit_location_latitude").val() : '';
            let lon = $("#edit_location_latitude").val() != $("#lod_latitude").val() || $("#edit_location_longitude").val() != $("#lod_longitude").val() ? $("#edit_location_longitude").val() : '';

            const base_url = window.location.origin;
            $.ajax({
                url: base_url + '/doctor/check_doctor_detail',
                type: 'POST',
                dataType: 'JSON',
                data: {email, country_code, phone, lat, lon},
                success: function (res){
                    if (res.check_email == false) $("#detail_email_error").removeClass("d-none");
                    else $("#detail_email_error").addClass("d-none");

                    if (res.check_mobileno == false) $("#detail_phone_error").removeClass("d-none");
                    else $("#detail_phone_error").addClass("d-none");

                    if (res.zonec == false) $("#detail_zone_error").removeClass("d-none");
                    else  $("#detail_zone_error").addClass("d-none");
                    
                    if (res.check_email == true && res.check_mobileno == true && res.zonec == true) {
                        $("#edit_doc_form_click").submit();
                    }
                }
            });
        }
    });

    $(document).on('click', '#time_btn', function(){
        $(this).toggleClass('btn-light btn-primary');
        time = $(this).attr("data-time")
        
        let current_row = $(this).parents(".time_div")
        let check_val = current_row.find("#time_input").val()
        check_val == "" ? current_row.find("#time_input").val(time) : current_row.find("#time_input").val("")
    })

    $(document).on("change", "#doc_time_per_pat_hos", function(){
        if ($(this).val()) {
            if ($("#old_hos").val() != $(this).val()) {
                
                const base_url = window.location.origin;
                $.ajax({
                    url: base_url + '/user/doc_time_change',
                    type: 'POST',
                    dataType: 'JSON',
                    data: {hospital: $(this).val()},
                    success: function (res){
                        let data = ''
                        for (const [index, day_data] of res.day_list.entries()) {
                            data += `<div class="col-12 form-group border-bottom pb-5">
                                        <div class="row">
                                            <div class="col-12 d-flex align-items-center justify-content-center">
                                                <span class="btn btn-light disabled f-16 f-w-600 mb-3">${day_data}</span>
                                            </div>
                                            <div class="col-12">
                                                <div class="row">`;
        
                            const timeSlots = ["Morning", "Afternoon", "Evening"];
        
                            for (const slot of timeSlots) {
                                data += `<div class="col-lg-4 col-md-4 col-sm-3 text-center">
                                            <span class="f-16 f-w-500 mb-2">${slot}</span>
                                            <div class="d-flex flex-wrap justify-content-center">`;
        
                                for (const date_time of res.ndatelist[index][day_data][slot]) {
                                    const btnClass = date_time.s == 1 ? 'btn-primary' : 'btn-light';
                                    const disabledClass = date_time.o == 1 ? 'disabled' : '';
        
                                    data += `<div class="p-1 time_div">
                                                <span class="btn btn-square ${btnClass} ${disabledClass} time_box" id="time_btn" data-time="${date_time.t}">${date_time.t}</span>
                                                <input class="inc" type="hidden" id="time_input" name="${day_data}_${slot}" value="${date_time.s == 1 ? date_time.t : ''}">
                                             </div>`;
                                }
        
                                data += `</div></div>`;
                            }
                            data += `</div></div></div></div>`;
                        }
                        $("#doc_time_management").html('');
                        $("#doc_time_management").html(data);
                        $("#old_hos").val($("#doc_time_per_pat_hos").val());
                    }
                });
    
            }
        }
    });

    $(document).on("click", "#doc_time_mam_btn", function(){
        let mcheck = 0, check = 0
        if ($("#doc_time_per_pat_hos").val() == '') mcheck++
        $(".inc").each(function(){
            if($(this).val() != "") check += 1;
        });
        if (mcheck != 0 || check == 0) $("#detail_error").removeClass("d-none");
        else {
            $("#detail_error").addClass("d-none");
            $("#doc_timeu_form").submit();
        }
    });

    $(document).on("click", "#edit_vit_phy_scr", function(){
        const { id, title, status } = $(this).data();

        $("#vit_phy_edit_form").attr('action', '/user/edit_vit_phy/' + id);
        $("#vit_phy_title").val(title);
        status == 1 ? $("#vit_phy_status").prop("checked", true) : $("#vit_phy_status").prop("checked", false);
    });

    $(document).on("click", "#edit_medicine_src", function(){
        const { id, name, status } = $(this).data();

        $("#medicine_edit_form").attr('action', '/user/edit_medicine/' + id);
        $("#medicine_name").val(name);
        status == 1 ? $("#medicine_status").prop("checked", true) : $("#medicine_status").prop("checked", false);
    });

    $(document).on("click", "#edit_diagnosis_src", function(){
        const { id, name, description, status } = $(this).data();

        $("#diagnosis_edit_form").attr('action', '/user/edit_diagnosis/' + id);
        $("#diagnosis_name").val(name);
        $("#diagnosis_desc").val(description);
        status == 1 ? $("#diagnosis_status").prop("checked", true) : $("#diagnosis_status").prop("checked", false);
    });

    $(document).on("click", "#edit_edit_can_reason_src", function(){
        const { id, title, status } = $(this).data();

        $("#canrason_edit_form").attr('action', '/settings/edit_cancel_reason/' + id);
        $("#canrason_text").val(title);
        status == 1 ? $("#canrason_status").prop("checked", true) : $("#canrason_status").prop("checked", false);
    });

    $(document).on("click", "#edit_reception_src", function(){
        const { id, email, status } = $(this).data();

        $("#rece_edit_form").attr('action', '/user/edit_receptionist/' + id);
        $("#rece_email").val(email);
        status == 1 ? $("#rece_status").prop("checked", true) : $("#rece_status").prop("checked", false);
    });

    $(document).on("click", "#add_rece_btn", function(){
        if ($(this).attr("data-s") == 1) {
            if ($("#rece_ccode").val() != null && $("#rece_phone").val() != '' && $("#rece_password").val() != '') {
                $("#detail_error").addClass("d-none");
                const base_url = window.location.origin;
                $.ajax({
                    url: base_url + '/user/add_receptionist_data',
                    type: 'POST',
                    dataType: 'JSON',
                    data: {country_code: $("#rece_ccode").val(), phone: $("#rece_phone").val(), password: $("#rece_password").val(), status: $("#rece_status").prop("checked")},
                    success: function (res){
                        if (res.status == false )  $("#detail_phone_error").removeClass("d-none");

                        if (res.status == true) {
                            $("#detail_phone_error").addClass("d-none");
                            toastr.success('Receptionist add successful');
                            window.location.reload();
                        }
                    }
                });
            } else $("#detail_error").removeClass("d-none");

        } else {
            if ($("#rece_ccode").val() != null && $("#rece_phone").val() != '') {
                $("#detail_error").addClass("d-none");
                const base_url = window.location.origin;
                $.ajax({
                    url: base_url + '/user/edit_receptionist/' + $(this).attr("data-id"),
                    type: 'POST',
                    dataType: 'JSON',
                    data: {country_code: $("#rece_ccode").val(), phone: $("#rece_phone").val(), password: $("#rece_password").val(), status: $("#rece_status").prop("checked")},
                    success: function (res){
                        if (res.status == false && res.error == 2) $("#detail_not_error").removeClass("d-none");
                        else $("#detail_not_error").addClass("d-none");

                        if (res.status == false && res.error == 1)  $("#detail_phone_error").removeClass("d-none");

                        if (res.status == true) {
                            $("#detail_phone_error").addClass("d-none");
                            toastr.success('Receptionist update successful');
                            window.location.reload();
                        }
                    }
                });
            } else $("#detail_error").removeClass("d-none");
        }
    });

    $(document).on("click", "#edit_reception", function(){
        const { id, country_code, phone, status, edit, receptionist } = $(this).data();
        
        $("#add_rece_btn").attr("data-id", id);
        $("#add_rece_btn").attr("data-s", 2);
        $("#add_rece_btn").text('').text(`${edit} ${receptionist}`);
        $("#rece_ccode").select2().val(country_code).trigger('change');
        $("#rece_phone").val(phone);
        status == 1 ? $("#rece_status").prop("checked", true) : $("#rece_status").prop("checked", false);
    });

    $(document).on("click", "#store_d_check", function(){
        let check = 0
        $(".ssc").each(function(){
            if($(this).val() == "" || $(this).val() == null) check += 1;
        });
        if (check > 0) $("#detail_error").removeClass("d-none");
        else {
            $("#detail_error").addClass("d-none");

            const base_url = window.location.origin;
            $.ajax({
                url: base_url + '/user/check_store_detail',
                type: 'POST',
                dataType: 'JSON',
                data: {sname: $("#sname").val(), sccode: $("#sccode").val(), sphone: $("#sphone").val()},
                success: function (res){
                    if (res.snc == 1) $("#detail_sname_error").removeClass("d-none");

                    if (res.scpc == 1) $("#detail_phone_error").removeClass("d-none");

                    if (res.snc == 0 && res.scpc == 0) {
                        $("#detail_sname_error").addClass("d-none");
                        $("#detail_phone_error").addClass("d-none");
                        $("#store_sd_form").submit();
                    }

                }
            });

        }
    });

    $(document).on("click", "#editstore_d_check", function(){
        let check = 0
        $(".ssc").each(function(){
            if($(this).val() == "" || $(this).val() == null) check += 1;
        });
        
        if (check > 0) {
            $("#detail_error").removeClass("d-none");
        } else {
            $("#detail_error").addClass("d-none");

            const base_url = window.location.origin;
            let ncheck = 0, pcheck = 0;

            let sname = $("#sname").val() != $("#esname").val() ? $("#sname").val() : '';
            let sccode = $("#sccode").val() != $("#esccode").val() || $("#sphone").val() != $("#esphone").val() ? $("#sccode").val() : '';
            let sphone = $("#sccode").val() != $("#esccode").val() || $("#sphone").val() != $("#esphone").val() ? $("#sphone").val() : '';

            if (sname != '' || sccode != '' || sphone != '') {
                $.ajax({
                    url: base_url + '/user/check_store_detail',
                    type: 'POST',
                    dataType: 'JSON',
                    data: {sname, sccode, sphone},
                    success: function (res){
                        if (res.snc == 1) $("#detail_sname_error").removeClass("d-none");

                        if (res.scpc == 1) $("#detail_phone_error").removeClass("d-none");

                        if (res.snc == 0) {
                            $("#detail_sname_error").addClass("d-none");
                            $("#detail_phone_error").addClass("d-none");
                            $("#store_sd_form").submit();
                        }
                    }
                });
            } else {
                $("#store_sd_form").submit();
            }
        }
    });

    $(document).on("click", "#addmppbtn", function(){
        const { title, price, price_d, enter, base, offer, discount } = $(this).data();

        const data = '<div class="row" id="delmorep">'+
                        '<div class="col-sm-12 col-md-6 col-lg-3 col-xl-3 form-group">'+
                          '<label class="col-form-label">'+ price +' '+ title +'</label>'+
                          '<input class="form-control img_check" type="text" name="price_title" placeholder="'+ price_d +'" required>'+
                        '</div>'+
                        '<div class="col-sm-12 col-md-6 col-lg-2 col-xl-3" form-group">'+
                          '<label class="col-form-label">'+ base +' '+ price +'</label>'+
                          '<input class="form-control img_check" type="number" name="base_price" placeholder="'+ enter +' '+ base +' '+ price +'" required>'+
                        '</div>'+
                        '<div class="col-sm-12 col-md-6 col-lg-2 col-xl-3" form-group">'+
                          '<label class="col-form-label">'+ offer +' '+ price +'</label>'+
                          '<input class="form-control img_check" type="number" name="price" placeholder="'+ enter +' '+ offer +' '+ price +'" required>'+
                        '</div>'+
                        '<div class="col-sm-12 col-md-6 col-lg-2 col-xl-2" form-group">'+
                          '<label class="col-form-label">'+ discount +' '+ price +'</label>'+
                          '<input class="form-control img_check" type="number" name="discount" placeholder="'+ enter +' '+ discount +' '+ price +'" required>'+
                        '</div>'+
                        '<div class="col-sm-1 col-md-1 col-lg-1 col-xl-1 form-group" style="margin-top: 43px;">'+
                            '<a type="button" class="mx-4 text-danger delpackdbtn"><i class="fa fa-trash-o f-24"></i></a>'+
                        '</div>'+
                    '</div>';
        $("#addmorep").append(data);
    });

    $(document).on("click", ".delpprow", function(){
        $(this).parents("#delmorep").remove();
    });



    $(document).on("submit", ".addlbif", function(e){
        e.preventDefault();
        const bimg = new FormData(this);
        const base_url = window.location.origin;
        $.ajax({
            url: base_url + '/lab/add_lab_banner',
            type: 'POST',
            data: bimg,
            processData: false, contentType: false,
            success: function (res){
                if (res.status == true) {
                    $('#file-preview-container').html('');
                    $(".addlbimginp").val('');
                    $('#allbdata').html('');
                    
                    let html = '', edits = $("#lbanad").attr("data-adrol");
                    $.each(res.imglist, function(index, value){
                        html += '<div class="col-2 align-content-center text-center mainslbimg mt-3">'+
                                    '<div class="sbanner">'+
                                        '<img class="showlbimg" src="../../'+value+'" height="190" width="190" alt="'+res.Banner+' '+res.Image+'">';
                            if (edits == 1) {
                                html += '<div class="d-flex justify-content-end action edlbanner mt-1"> '+
                                            '<div class="edit"><a id="elabbanner" data-biuid="'+value+'" data-edit="'+res.edit+'"><i class="f-18 icon-pencil-alt"></i></a></div>'+
                                            '<div class="delete"><a id="dlbimage" data-biuid="'+value+'" data-edit="'+res.edit+'"><i class="f-18 icon-trash"></i></a></div>'+
                                        '</div>';
                            } else {
                                html += '<div class="d-flex justify-content-end action edlbanner mt-3"></div>';
                            }
                            html += '</div>'+
                                '</div>';
                    });
                    $('#allbdata').html(html);
                    toastr.success('Banner Add successful');
                } else toastr.error('Something went wrong!');
            }
        });
    })



    $(document).on("click", "#elabbanner", function(){
        const current_row = $(this).parents('.mainslbimg');
        const bimg = current_row.find('.edlbanner');
        bimg.html('');
        bimg.html('<div class="m-1">'+
                        '<form class="needs-validation upbing" enctype="multipart/form-data">'+
                            '<input class="form-control biminput" type="file" name="image" accept="image/*" required>'+
                            '<input type="hidden" name="biuid" value="'+ $(this).data('biuid') +'">'+
                            '<div class="d-flex align-content-center justify-content-center mt-1">'+
                                '<button class="btn btn-primary btn-square b-r-10 ebbtn" data-biuid="'+ $(this).data('biuid') +'" style="padding: 4px 10px;" type="submit">'+ $(this).data('edit') +'</button>'+
                                '<a><i class="m-l-10 fa fa-times removebibtn" data-biuid="'+ $(this).data('biuid') +'" data-edit="'+ $(this).data('edit') +'"></i></a>'+
                            '</div>'+
                        '</form>'+
                    '</div>');

    })

    $(document).on("click", ".removebibtn", function(){
        const current_row = $(this).parents('.mainslbimg');
        const bimg = current_row.find('.edlbanner');
        bimg.html('');
        bimg.html('<div class="edit"><a id="elabbanner" data-biuid="'+ $(this).data('biuid') +'" data-edit="'+ $(this).data('edit') +'"><i class="f-18 icon-pencil-alt"></i></a></div>'+
                    '<div class="delete"><a id="dlbimage" data-biuid="'+ $(this).data('biuid') +'" data-edit="'+ $(this).data('edit') +'"><i class="f-18 icon-trash"></i></a></div>');

    })

    $(document).on("change", ".biminput", function(event){
        const current_row = $(this).parents('.mainslbimg');
        const file = event.target.files[0];
        const fileURL = URL.createObjectURL(file);
        current_row.find(".showlbimg").attr('src', fileURL);
    })

    $(document).on("submit", ".upbing", function(e){
        e.preventDefault();
        const current_row = $(this).parents('.mainslbimg');
        
        const bimg = new FormData(this);
        const base_url = window.location.origin;
        $.ajax({
            url: base_url + '/lab/edit_lab_banner',
            type: 'POST',
            data: bimg,
            processData: false, contentType: false,
            success: function (res){
                if (res.status == true) {
                    toastr.success('Image update successful');
                    const bimg = current_row.find('.edlbanner');
                    bimg.html('');
                    bimg.html('<div class="edit"><a id="elabbanner" data-biuid="'+ res.biuid +'" data-edit="'+ res.edit +'"><i class="f-18 icon-pencil-alt"></i></a></div>'+
                                '<div class="delete"><a id="dlbimage" data-biuid="'+ res.biuid +'" data-edit="'+ res.edit +'"><i class="f-18 icon-trash"></i></a></div>');
                } else toastr.error('Something went wrong');
            }
        });
    })

    $(document).on("click", "#dlbimage", function(){
        const current_row = $(this).parents('.mainslbimg');
        
        const base_url = window.location.origin;
        $.ajax({
            url: base_url + '/lab/delete_lab_banner',
            type: 'POST',
            dataType: 'JSON',
            data: {biuid: $(this).data('biuid')},
            success: function (res){
                if (res.status == true) {
                    if (res.c == 1) {
                        toastr.success('Image delete successful');
                        current_row.remove();
                    } else {
                        $("#allbdata").html('');
                        $("#allbdata").html('<div class="row" id="allbdata">'+
                                                '<h5>'+ res.bnf +'!</h5>'+
                                            '</div>');
                    }
                } else toastr.error('Something went wrong');
            }
        });
    })

    $(document).on("click", "#lab_add_signup_btn", function(){
        let check = 0
        $(".docin").each(function(){
            if($(this).val() == "" || $(this).val() == null) check += 1;
        });
        
        if (check != 0) $("#detail_error").removeClass("d-none");
        else {
            $("#detail_error").addClass("d-none");
            const base_url = window.location.origin;
            $.ajax({
                url: base_url + '/lab/check_lab_detail',
                type: 'POST',
                dataType: 'JSON',
                data: {email: $("#lab_email").val(), country_code: $("#lab_code").val(), phone: $("#lab_number").val(), lat: $("#location_latitude").val(), lon: $("#location_longitude").val()},
                success: function (res){
                    if (res.check_email == false) $("#detail_email_error").removeClass("d-none");
                    else $("#detail_email_error").addClass("d-none");

                    if (res.check_mobileno == false) $("#detail_phone_error").removeClass("d-none");
                    else $("#detail_phone_error").addClass("d-none");

                    if (res.zonec == false) $("#detail_zone_error").removeClass("d-none");
                    else  $("#detail_zone_error").addClass("d-none");
                    
                    if (res.check_email == true && res.check_mobileno == true && res.zonec == true) {
                        $("#lab_signup_form").submit();
                    }
                }
            });
        }
    });

    $(document).on("click", "#lab_edit_signup_btn", function(){
        let check = 0
        $(".docin").each(function(){
            if($(this).val() == "" || $(this).val() == null) check += 1;
        });
        
        if (check != 0) $("#detail_error").removeClass("d-none");
        else {
            $("#detail_error").addClass("d-none");

            let email = $("#lab_email").val() != $("#old_email").val() ? $("#lab_email").val() : '';
            let country_code = $("#lab_code").val() != $("#old_ccode").val() || $("#lab_number").val() != $("#old_phone").val() ? $("#lab_code").val() : '';
            let phone = $("#lab_code").val() != $("#old_ccode").val() || $("#lab_number").val() != $("#old_phone").val() ? $("#lab_number").val() : '';

            let lat = $("#edit_location_latitude").val() != $("#lod_latitude").val() || $("#edit_location_longitude").val() != $("#lod_longitude").val() ? $("#edit_location_latitude").val() : '';
            let lon = $("#edit_location_latitude").val() != $("#lod_latitude").val() || $("#edit_location_longitude").val() != $("#lod_longitude").val() ? $("#edit_location_longitude").val() : '';
            
            const base_url = window.location.origin;
            $.ajax({
                url: base_url + '/lab/check_lab_detail',
                type: 'POST',
                dataType: 'JSON',
                data: {email, country_code, phone, lat, lon},
                success: function (res){
                    if (res.check_email == false) $("#detail_email_error").removeClass("d-none");
                    else $("#detail_email_error").addClass("d-none");

                    if (res.check_mobileno == false) $("#detail_phone_error").removeClass("d-none");
                    else $("#detail_phone_error").addClass("d-none");

                    if (res.zonec == false) $("#detail_zone_error").removeClass("d-none");
                    else  $("#detail_zone_error").addClass("d-none");
                    
                    if (res.check_email == true && res.check_mobileno == true && res.zonec == true) {
                        $("#lab_edit_signup_form").submit();
                    }
                }
            });
        }
    });

    $(document).on("change", "#lab_pack_type", function(){
        const ptype = $(this).val();
        const { add, package, name, price, enter } = $(this).data();

        if (ptype == "Individual") {
            $("#addmorep").html('');
            const data = '<div class="row" id="delmorep">'+
                                '<div class="row" id="delmorep">'+
                                    '<div class="col-sm-12 col-md-6 col-lg-6 col-xl-6 form-group">'+
                                        '<label class="col-form-label">'+ package +' '+ name +'</label>'+
                                        '<input class="form-control" type="text" name="package_name" placeholder="'+ enter +' '+ package +' '+ name +'" required>'+
                                    '</div>'+
                                    '<div class="col-sm-12 col-md-6 col-lg-6 col-xl-6 form-group">'+
                                        '<label class="col-form-label">'+ package +' '+ price +'</label>'+
                                        '<input class="form-control" type="number" name="package_price" placeholder="'+ enter +' '+ package +' '+ price +'" required>'+
                                    '</div>'+
                                '</div>'+
                            '</div>'
    
            $("#addmorep").html(data);
        }

        if (ptype == "Package") {
            $("#addmorep").html('');
            const data = '<div class="row">'+
                                            '<div class="text-end mt-2">'+
                                                '<a class="btn btn-primary btn-square b-r-10" id="addpackpnp" data-package="Package" data-name="Name" data-price="Price" data-enter="Enter">'+ add +' '+ package +'</a>'+
                                            '</div>'+
                                        '</div>'+
                                        '<div class="row" id="delmorep">'+
                                            '<div class="col-sm-12 col-md-6 col-lg-5 col-xl-5 form-group">'+
                                                '<label class="col-form-label">'+ package +' '+ name +'</label>'+
                                                '<input class="form-control" type="text" name="package_name" placeholder="'+ enter +' '+ package +' '+ name +'" required>'+
                                            '</div>'+
                                            '<div class="col-sm-11 col-md-5 col-lg-5 col-xl-5 form-group">'+
                                                '<label class="col-form-label">'+ package +' '+ price +'</label>'+
                                                '<input class="form-control" type="number" name="package_price" placeholder="'+ enter +' '+ package +' '+ price +'" required>'+
                                            '</div>'+
                                            '<div class="col-sm-1 col-md-1 col-lg-1 col-xl-1 form-group" style="margin-top: 43px;">'+
                                            '</div>'+
                                        '</div>'+
                                        '<div class="row" id="delmorep">'+
                                            '<div class="col-sm-12 col-md-6 col-lg-5 col-xl-5 form-group">'+
                                                '<label class="col-form-label">'+ package +' '+ name +'</label>'+
                                                '<input class="form-control" type="text" name="package_name" placeholder="'+ enter +' '+ package +' '+ name +'" required>'+
                                            '</div>'+
                                            '<div class="col-sm-11 col-md-5 col-lg-5 col-xl-5 form-group">'+
                                                '<label class="col-form-label">'+ package +' '+ price +'</label>'+
                                                '<input class="form-control" type="number" name="package_price" placeholder="'+ enter +' '+ package +' '+ price +'" required>'+
                                            '</div>'+
                                            '<div class="col-sm-1 col-md-1 col-lg-1 col-xl-1 form-group" style="margin-top: 43px;">'+
                                            '</div>'+
                                        '</div>'
    
            $("#addmorep").html(data);
        }
        
    });
    
    $(document).on("click", "#addpackpnp", function(){
        const { package, name, price, enter } = $(this).data();
        const data = '<div class="row" id="delmorep">'+
                         '<div class="col-sm-12 col-md-6 col-lg-5 col-xl-5 form-group">'+
                           '<label class="col-form-label">'+ package +' '+ name +'</label>'+
                           '<input class="form-control img_check" type="text" name="package_name" placeholder="'+ enter +' '+ package +' '+ name +'" required>'+
                         '</div>'+
                         '<div class="col-sm-11 col-md-5 col-lg-5 col-xl-5 form-group">'+
                           '<label class="col-form-label">'+ package +' '+ price +'</label>'+
                           '<input class="form-control img_check" type="number" name="package_price" placeholder="'+ enter +' '+ package +' '+ price +'" required>'+
                         '</div>'+
                        '<div class="col-sm-1 col-md-1 col-lg-1 col-xl-1 form-group" style="margin-top: 43px;">'+
                            '<a type="button" class="mx-4 text-danger delpackdbtn"><i class="fa fa-trash-o f-24"></i></a>'+
                        '</div>'+
                    '</div>'

        $("#addmorep").append(data);
    });

    $(document).on("click", ".delpackdbtn", function(){
        $(this).parents("#delmorep").remove();
    });

    $(document).on('click', '#edit_lab_coupon', function(){
        let { id, title, sub_title, code, min_amount, discount_amount, start_date, end_date } = $(this).data();
        
        $('#coupon_edit_form').attr('action', '/lab/edit_coupon/' + id);
        $('#edit_title').attr('value', title);
        $('#edit_subtitle').attr('value', sub_title);
        $('.edit_code').attr('value', code);
        
        let start_date_date = new Date(start_date);
        let start_date_day = (start_date_date.getDate() < 10 ? '0' + parseInt(start_date_date.getDate()) : start_date_date.getDate());
        let start_date_month = (start_date_date.getMonth()+1 < 10 ? '0' + parseInt(start_date_date.getMonth()+1) : start_date_date.getMonth()+1);
        let start_date_year = start_date_date.getFullYear();
        let start_dates = `${start_date_year}-${start_date_month}-${start_date_day}`;
        $('#edit_start').attr('value', start_dates);
  
        let end_date_date = new Date(end_date);
        let end_date_day = (end_date_date.getDate() < 10 ? '0' + parseInt(end_date_date.getDate()) : end_date_date.getDate());
        let end_date_month = (end_date_date.getMonth()+1 < 10 ? '0' + parseInt(end_date_date.getMonth()+1) : end_date_date.getMonth()+1);
        let end_date_year = end_date_date.getFullYear();
        let end_dates = `${end_date_year}-${end_date_month}-${end_date_day}`;
        $('#edit_end').attr('value', end_dates);
  
        $('#edit_minimuma').attr('value', min_amount);
        $('#edit_discounta').attr('value', discount_amount);
    });

    $(document).on("click", "#lab_add_user_btn", function(){
        let check = 0
        $(".docin").each(function(){
            if($(this).val() == "" || $(this).val() == null) check += 1;
        });
        
        if (check != 0) $("#detail_error").removeClass("d-none");
        else {
            $("#detail_error").addClass("d-none");
            const base_url = window.location.origin;
            $.ajax({
                url: base_url + '/lab/check_collect_data',
                type: 'POST',
                dataType: 'JSON',
                data: {email: $("#lab_col_email").val(), country_code: $("#lab_col_code").val(), phone: $("#lab_col_number").val()},
                success: function (res){
                    if (res.check_email == false) $("#detail_email_error").removeClass("d-none");
                    else $("#detail_email_error").addClass("d-none");

                    if (res.check_mobileno == false) $("#detail_phone_error").removeClass("d-none");
                    else $("#detail_phone_error").addClass("d-none");

                    if (res.check_email == true && res.check_mobileno == true) {
                        $("#add_lab_home_collect_user").submit();
                    }
                }
            });
        }
    });

    $(document).on("click", "#lab_edit_user_btn", function(){
        let check = 0
        $(".docin").each(function(){
            if($(this).val() == "" || $(this).val() == null) check += 1;
        });
        
        if (check != 0) $("#detail_error").removeClass("d-none");
        else {
            $("#detail_error").addClass("d-none");

            let email = $("#lab_col_email").val() != $("#old_lab_col_email").val() ? $("#lab_col_email").val() : '';
            let country_code = $("#lab_col_code").val() != $("#old_lab_col_code").val() || $("#lab_col_number").val() != $("#old_phone").val() ? $("#lab_col_code").val() : '';
            let phone = $("#lab_col_code").val() != $("#old_lab_col_code").val() || $("#lab_col_number").val() != $("#old_lab_col_number").val() ? $("#lab_col_number").val() : '';
            
            const base_url = window.location.origin;
            $.ajax({
                url: base_url + '/lab/check_collect_data',
                type: 'POST',
                dataType: 'JSON',
                data: {email, country_code, phone},
                success: function (res){
                    if (res.check_email == false) $("#detail_email_error").removeClass("d-none");
                    else $("#detail_email_error").addClass("d-none");

                    if (res.check_mobileno == false) $("#detail_phone_error").removeClass("d-none");
                    else $("#detail_phone_error").addClass("d-none");

                    if (res.check_email == true && res.check_mobileno == true) {
                        $("#edit_lab_home_collect_user").submit();
                    }
                }
            });
        }
    });

    $(document).on("click", "#dscheck", function(){
        const current_row = $(this).parents(".mdscheck");
        current_row.find("#ds_status").val($(this).is(":checked") == true ? 1 : 0);
    });

    $(document).on("submit", ".addscb", function(e){
        e.preventDefault();
        const bimg = new FormData(this);
        const base_url = window.location.origin;
        $.ajax({
            url: base_url + '/user/add_sub_banner',
            type: 'POST',
            data: bimg,
            processData: false, contentType: false,
            success: function (res){
                if (res.status == true) {
                    $('#file-preview-container').html('');
                    $(".addbimginp").val('');
                    $('#allbid').html('');
    
                    let html = '';
                    $.each(res.imglist, function(index, value){
                        html += '<div class="col-2 align-content-center text-center mainsbimg mt-3">'+
                                    '<div class="sbanner">'+
                                        '<img class="showbimg" src="../../'+value+'" height="190" width="190" alt="'+res.Banner+' '+res.Image+'">'+
                                        '<div class="d-flex justify-content-end action edbanner mt-1"> '+
                                            '<div class="edit"><a id="bedit" data-biuid="'+value+'" data-edit="'+res.edit+'"><i class="f-18 icon-pencil-alt"></i></a></div>'+
                                            '<div class="delete"><a id="dbimage" data-biuid="'+value+'" data-edit="'+res.edit+'"><i class="f-18 icon-trash"></i></a></div>'+
                                        '</div>'+
                                    '</div>'+
                                '</div>'
                    });
                    $('#allbid').html(html);
                    toastr.success('Banner Add successful');
                } else toastr.error('Something went wrong!');
            }
        });
    })

    

    $(document).on("click", "#updsimg", function(){
        const current_row = $(this).parents("#maindse")
        const { id, edsimg, submit, cancel, status } = current_row.data();
        if (status == "1") {
            const file = current_row.find("#hd_img_inp")[0]
            if (file.files.length > 0) {
    
                const formData = new FormData();
                formData.append("image", file.files[0]);
                formData.append("id", id);
                formData.append("edsimg", edsimg);
    
                const base_url = window.location.origin;
                $.ajax({
                    url: base_url + '/user/update_service_image',
                    type: 'POST',
                    data: formData,
                    processData: false,
                    contentType: false,
                    success: function (res){
                        if (res.ImageUrl != '') {
                            current_row.attr("data-edsimg", res.ImageUrl);
                            let imagedata = '<img height="70" width="70" id="dsimput" src="../../'+ res.ImageUrl +'" alt="">'+
                                        '<div class="action m-l-10">'+
                                            '<div class="edit">'+
                                                '<a class="edsimgd">'+
                                                    '<i class="icon-pencil-alt f-16"></i>'+
                                                '</a>'+
                                            '</div>'+
                                        '</div>';
                            current_row.html("");
                            current_row.addClass("d-flex justify-content-center align-items-end");
                            current_row.attr("data-status", "2");
                            current_row.html(imagedata);
                            toastr.success('Image Update Successful.');
                        } else toastr.error('Something went wrong.');
                    }
                });
            } else toastr.error('Please Select Image!');
        }
    });

    $(document).on("click", ".canedsb", function(){
        const current_row = $(this).parents("#maindse");
        const img = current_row.attr("data-edsimg");
        if (img != '') {
            let imagedata = '<img height="70" width="70" id="dsimput" src="../../'+ img +'" alt="">'+
                            '<div class="action m-l-10">'+
                                '<div class="edit">'+
                                    '<a class="edsimgd">'+
                                        '<i class="icon-pencil-alt f-16"></i>'+
                                    '</a>'+
                                '</div>'+
                            '</div>';
    
            current_row.html("");
            current_row.addClass("d-flex justify-content-center align-items-end");
            current_row.attr("data-status", "2");
            current_row.html(imagedata);
        }
    });

    $(document).on("click", ".edsimgd", function(){
        const current_row = $(this).parents("#maindse");

        const data = '<input class="form-control mt-3 mb-1" id="hd_img_inp" type="file" accept="image/*">'+
                        '<div class="d-flex justify-content-center">'+
                            '<span class="badge badge-primary btn-hover p-2" id="updsimg">'+ current_row.attr("data-submit") +'</span>'+
                            '<span class="badge badge-danger btn-hover canedsb p-2">'+ current_row.attr("data-cancel") +'</span>'+
                        '</div>';

        current_row.html("");
        current_row.removeClass("d-flex justify-content-center align-items-end");
        current_row.attr("data-status", "1");
        current_row.html(data);
    });

    $(document).on("change", "#updymod", function(){
        const s = $(this).val();
        const { select, location, nearest, all, hospital, department, list, type, category } = $(this).data();

        if (s == "Hospital" || s == "Doctor" || s == "Lab") {
            let st = ''
            if (s == "Hospital") st = hospital;
            if (s == "Doctor") st = department;
            if (s == "Lab") st = category;  
            
            const base_url = window.location.origin;
            $.ajax({
                url: base_url + '/dynamic/require_data',
                type: 'POST',
                dataType: 'JSON',
                data: {s},
                success: function (res){
                    if (res.cl != '') {
                        let data = '';
                        data += `<div class="row">
                                    <div class="col-12">
                                        <label class="col-form-label">${st} ${list}</label>
                                        <select class="js-example-basic-single" name="category" required>
                                            <option value selected disabled>${select} ${st} ${list}</option>`

                                            $.each(res.cl, function(index, value){
                                                data += `<option value="${value.id}">${value.name}</option>`
                                            });

                                        data += `</select>
                                    </div>
                                </div>`
                        
                        $("#updynsec").html('')
                        $("#updynsec").html(data);
                        $('.js-example-basic-single').select2();
                    }
                }
            });
        }
    });

    $(document).on("click", "#lbapproveaaaaaaaaa", function(){
        const current_row = $(this).parents("#maindse");

        const data = '<input class="form-control mt-3 mb-1" id="hd_img_inp" type="file" accept="image/*">'+
                        '<div class="d-flex justify-content-center">'+
                            '<span class="badge badge-primary btn-hover p-2" id="updsimg">'+ current_row.attr("data-submit") +'</span>'+
                            '<span class="badge badge-danger btn-hover canedsb p-2">'+ current_row.attr("data-cancel") +'</span>'+
                        '</div>';

        current_row.html("");
        current_row.removeClass("d-flex justify-content-center align-items-end");
        current_row.attr("data-status", "1");
        current_row.html(data);
    });

    $(document).on("click", "#lbapprove", function(){
        const { mid } = $(this).data();
        const current_row = $(this).parents(`.lomaintr${mid}`);
        const { id, assign, user, details, ongoing, list } = current_row.find(`#moa${mid}`).data();

        const base_url = window.location.origin;
        $.ajax({
            url: base_url + '/lab/web/lab_appoint_accept',
            type: 'POST',
            dataType: 'JSON',
            data: {id},
            success: function (res){
                if (res.status == true) {
                    current_row.find(`#moa${id}`).html('');
                    
                    if (res.ns == "3") {
                        
                        if (res.user_list != '') {
                            current_row.find(`#collectrd${id}`).html("");
    
                            let ndata = `<select class="js-example-basic-single" id="labcollist" style="height: 10px !important; " required>
                                                <option value selected disabled>${user} ${list}</option>`
    
                                                $.each(res.user_list, function(index, value){
                                                    ndata += `<option value="${value.id}">${value.name}</option>`
                                                });
    
                                            ndata += `</select>`;
    
                            current_row.find(`#collectrd${id}`).html(ndata);
                            $('.js-example-basic-single').select2();
                        }

                        current_row.find(`#moa${id}`).html(`<a class="dropdown-item" data-mid="${id}" id="lbassigncol"><i class="fa fa-search f-16 m-r-10"></i>${assign} ${user}</a>
                                            <a class="dropdown-item" href="/lab/booking_details/${id}"><i class="fa fa-list-alt f-16 m-r-10"></i>${details}</a>`);
                                            
                    } else {
                        
                        current_row.find(`#moa${id}`).html(`<a class="dropdown-item" data-mid="${id}" id="lbongoing"><i class="fa fa-taxi f-16 m-r-10"></i>${ongoing}</a>
                                            <a class="dropdown-item" href="/lab/booking_details/${id}"><i class="fa fa-list-alt f-16 m-r-10"></i>${details}</a>`);
                        
                    }
                    current_row.find(`#lbstatusid${id}`).removeClass("btn-warning").addClass("btn-info").text(res.title);
                    toastr.success(res.message);
                } else toastr.error(res.message);
            }
        });

    });

    $(document).on("change", "#lrcrasons", function(){
        const selectedTitle = $('#lrcrasons option:selected').data('title');
        if (selectedTitle && "other".match(new RegExp(selectedTitle, 'i'))) {
            $("#inpothreason").removeClass("d-none");
            $("#inpothreason").attr("data-c", 1);
        } else {
            $("#inpothreason").addClass("d-none");
            $("#inpothreason").attr("data-c", 0);
        }
    });

    $(document).on("click", "#lbacancel", function(){
        const { mid } = $(this).data();
        $("#uplbcancelbtn").attr("data-id", mid);
        $("#lrcrasons").select2().val("").trigger('change');
        $("#lbfileupload").val("");
    });

    $(document).on("click", "#uplbcancelbtn", function(){
        const { id } = $(this).data();
        const { details } = $(`#moa${id}`).data();
        const cul = $("#lrcrasons").val();
        let oth = '';
        const selectedTitle = $('#lrcrasons option:selected').data('title');
        if (selectedTitle && "other".match(new RegExp(selectedTitle, 'i'))) {
            oth = $("#lbfileupload").val();
            if (oth == '') {
                toastr.error('Write Cancel Reason.');
                $("#lbfileupload").addClass("is-invalid");
                return
            }
        }
        if (cul) {
            $("#lbfileupload").removeClass("is-invalid");
            $("#lrcrasons").removeClass("is-invalid");
            $("#clapcanreas").addClass("d-none");
            const base_url = window.location.origin;
            $.ajax({
                url: base_url + '/lab/web/lab_appoint_cancel',
                type: 'POST',
                dataType: 'JSON',
                data: {id, cul, oth},
                success: function (res){
                    if (res.status == true) {
                        $(`#moa${id}`).html('');
                        $(`#lbstatusid${id}`).removeClass("btn-warning").addClass("btn-danger").text(res.title);
                        $(`#moa${id}`).html(`<a class="dropdown-item" href="/lab/booking_details/${id}"><i class="fa fa-list-alt f-16 m-r-10"></i>${details}</a>`);
                        $("#lbreportclose").click();
                        toastr.success(res.message);
                    } else toastr.error(res.message);
                }
            });
        } else {
            $("#lrcrasons").addClass("is-invalid");
            $("#clapcanreas").removeClass("d-none");
            toastr.error('Please Select Cancel Reason.');
        }
    });

    $(document).on("click", "#lbassigncol", function(){
        const { mid } = $(this).data();
        const current_row = $(this).parents(`.lomaintr${mid}`);
        const { id, details, ongoing } = current_row.find(`#moa${mid}`).data();

        const cul = current_row.find("#labcollist").val();
        if (cul) {
            const base_url = window.location.origin;
            $.ajax({
                url: base_url + '/lab/web/lab_appoint_assi_coll',
                type: 'POST',
                dataType: 'JSON',
                data: {id, cul},
                success: function (res){
                    if (res.status == true) {
                        current_row.find(`#moa${id}`).html('');
    
                        current_row.find(`#lbstatusid${id}`).removeClass("btn-info").addClass("btn-secondary").text(res.title);
                        current_row.find(`#moa${id}`).html(`<a class="dropdown-item" data-mid="${id}" id="lbongoing"><i class="fa fa-taxi f-16 m-r-10"></i>${ongoing}</a>
                                            <a class="dropdown-item" href="/lab/booking_details/${id}"><i class="fa fa-list-alt f-16 m-r-10"></i>${details}</a>`);
                        
                        current_row.find(`#collectrd${id}`).html("");
                        current_row.find(`#collectrd${id}`).text(res.ul);
                        toastr.success(res.message);
                    } else toastr.error(res.message);
                }
            });
        } else toastr.error('Please Select Home Collect User.');
    });

    $(document).on("click", "#lbongoing", function(){
        const { mid } = $(this).data();
        const current_row = $(this).parents(`.lomaintr${mid}`);
        const { id, details, inprogress } = current_row.find(`#moa${mid}`).data();
        
        const base_url = window.location.origin;
        $.ajax({
            url: base_url + '/lab/web/lab_appoint_ongoing',
            type: 'POST',
            dataType: 'JSON',
            data: {id},
            success: function (res){
                if (res.status == true) {
                    current_row.find(`#moa${id}`).html('');
                    current_row.find(`#lbstatusid${id}`).removeClass("btn-secondary").addClass("btn-dark").text(res.title);
                    current_row.find(`#moa${id}`).html(`<a class="dropdown-item" data-mid="${id}" data-bs-toggle="modal" data-bs-target="#otpverift" id="lbinperson"><i class="fa fa-spin fa-spinner f-16 m-r-10"></i>${inprogress}</a>
                                        <a class="dropdown-item" href="/lab/booking_details/${id}"><i class="fa fa-list-alt f-16 m-r-10"></i>${details}</a>`);
                    toastr.success(res.message);
                } else toastr.error(res.message);
            }
        });
    });

    $(document).on("click", "#lbinperson", function(){
        const { mid } = $(this).data();
        $("#otpinp").val("");
        $("#lalotplaid").val(mid);
        $("#otpvalidate").addClass("d-none");
        $("#otpinp").removeClass("is-invalid");
    });

    $(document).on("click", "#otpcheckid", function(){
        const id = $("#lalotplaid").val();
        const { details, completed, upload, report } = $(`#moa${id}`).data();
        const otp = $("#otpinp").val();
        if (otp != '' && !isNaN(otp)) {
            $("#otpinpvalidate").addClass("d-none");
            const base_url = window.location.origin;
            $.ajax({
                url: base_url + '/lab/web/lab_appoint_inprogress',
                type: 'POST',
                dataType: 'JSON',
                data: {id, otp},
                success: function (res){
                    if (res.status == '4') {
                        $(`#moa${id}`).html('');
                        $(`#lbstatusid${id}`).removeClass("btn-dark").addClass("btn-primary").text(res.title);
                        $(`#moa${id}`).html(`<a class="dropdown-item" data-mid="${id}" data-bs-toggle="modal" data-bs-target="#uploadreport" id="lbuplreport"><i class="fa fa-upload f-16 m-r-10"></i>${upload} ${report}</a>
                                            <a class="dropdown-item" data-mid="${id}" id="lbcomplete"><i class="fa fa-thumbs-o-up f-16 m-r-10"></i>${completed}</a>
                                            <a class="dropdown-item" href="/lab/booking_details/${id}"><i class="fa fa-list-alt f-16 m-r-10"></i>${details}</a>`);
                        $("#lbotpclose").click();
                        $("#otpvalidate").addClass("d-none");
                        $("#otpinp").removeClass("is-invalid");
                        $("#otpcheckid").attr("data-id", '0');
                        toastr.success(res.message);
                    } else {
                        $("#otpvalidate").removeClass("d-none");
                        $("#otpinp").addClass("is-invalid");
                        toastr.error(res.message);
                    }
                }
            });
        } else $("#otpinpvalidate").removeClass("d-none");
    });

    $(document).on("click", "#lbuplreport", function(){
        const { mid } = $(this).data();
        const base_url = window.location.origin;
        $.ajax({
            url: base_url + '/lab/web/lab_patient_data',
            type: 'POST',
            dataType: 'JSON',
            data: {id: mid},
            success: function (res){
                if (res.status == true && res.appont != '') {
                    let data = ''
                    $.each(res.appont[0].package_id, function(index, value){
                        data += `<span>${value.title}</span>
                                <div class="row mt-2 mb-2 border-bottom">`
                            $.each(value.f, function(i, val){
                                data += `<div class="col-sm-6 col-md-6 col-lg-4 col-xl-4 text-center">
                                    <img class="b-r-6 border-2 hand-hover lbmainf" id="fmsel" data-pid="${value.pid}" data-fid="${val.id.id}" height="100" width="100" 
                                    src="../../${val.id.profile_image}" alt="Image">
                                    <p class="${val.d != '' ? 'border-bottom border-success border-2' : ''}">${val.id.name}</p>
                                </div>`
                            });
                        data += `</div>`;
                    });
                    $("#lbreportp").html("");
                    $("#lbreportp").html(data);
                    $("#uplbreport").attr("data-id", mid);
                    toastr.success(res.message);
                } else toastr.error(res.message);
            }
        });
    });

    $(document).on("click", "#fmsel", function(){
        const { pid, fid } = $(this).data();
        $(`.lbmainf`).each(function(){
            $(this).removeClass("b-primary");
        });
        $(this).addClass("b-primary");
        $("#laompid").val(pid);
        $("#laomfid").val(fid);
    });

    $(document).on("click", "#uplbreport", function(){
        const { id, s } = $(this).data();
        const file = $("#lbfileupload")[0], pid = $("#laompid").val(), fid = $("#laomfid").val()
        if (file.files.length > 0 && pid && fid) {
            $("#lbfileupload").removeClass("is-invalid");
            $("#checkfselval").addClass("d-none");
            const formData = new FormData();
            for (let i = 0; i < file.files.length; i++) {
                formData.append("report[]", file.files[i]);
            }
            formData.append("id", id);
            formData.append("pid", $("#laompid").val());
            formData.append("sfid", $("#laomfid").val());
            formData.append("comment", $("#lrbdescription").val());
    
            const base_url = window.location.origin;
            $.ajax({
                url: base_url + '/lab/web/lab_patient_report_upl',
                type: 'POST',
                data: formData,
                processData: false,
                contentType: false,
                success: function (res){
                    if (res.status == true) {
                        $("#lbreportclose").click();
                        $("#lbfileupload").val("");
                        $("#lrbdescription").val("");
                        $("#laompid").val("");
                        $("#laomfid").val("");
                        if (s == 2) {
                            $(`#lafmd${fid}`).text(res.imgd.d);
                            $(`#lafmo${fid}`).text(res.imgd.ti);
                            $(`#lafmc${fid}`).text(res.imgd.c);
                            $(`#ladfrdel${fid}`).removeClass("d-none");
                        }
                        toastr.success(res.message);
                    } else toastr.error(res.message);
                }
            });
    
        } else {
            if (file.files.length <= 0) $("#lbfileupload").addClass("is-invalid");
            if (!pid || !fid) $("#checkfselval").removeClass("d-none");
        }
    });

    $(document).on("click", "#lbcomplete", function(){
        const { mid } = $(this).data();
        const current_row = $(this).parents(`.lomaintr${mid}`);
        const { id, details, tot_price, paid_amount } = current_row.find(`#moa${mid}`).data();
        if (tot_price > paid_amount) {
            $("#paymentsucc").modal("show");
            $("#lalistccbtn").attr("data-id", mid);
        } else {
            const base_url = window.location.origin;
            $.ajax({
                url: base_url + '/lab/web/lab_appoint_complete',
                type: 'POST',
                dataType: 'JSON',
                data: {id},
                success: function (res){
                    if (res.status == true) {
                        current_row.find(`#moa${id}`).html('');
                        current_row.find(`#lbstatusid${id}`).removeClass("btn-primary").addClass("btn-success").text(res.title);
                        current_row.find(`#moa${id}`).html(`<a class="dropdown-item" href="/lab/booking_details/${id}"><i class="fa fa-list-alt f-16 m-r-10"></i>${details}</a>`);
                        toastr.success(res.message);
                    } else toastr.error(res.message);
                }
            });
        }
    });

    $(document).on("click", "#lalistccbtn", function(){
        const { id, paid } = $(this).data();
        const current_row = $(`.lomaintr${id}`);
        const { details } = $(`#moa${id}`).data();
        const base_url = window.location.origin;
        $.ajax({
            url: base_url + '/lab/web/lab_appoint_complete',
            type: 'POST',
            dataType: 'JSON',
            data: {id},
            success: function (res){
                if (res.status == true) {
                    $(`#lcashtd${id}`).html('').html(`<span class="btn-success px-3 b-r-5 f-14 f-w-400" style="padding: .25rem;">${paid}</span>`);
                    $(`#moa${id}`).html('');
                    $(`#lbstatusid${id}`).removeClass("btn-primary").addClass("btn-success").text(res.title);
                    $(`#moa${id}`).html(`<a class="dropdown-item" href="/lab/booking_details/${id}"><i class="fa fa-list-alt f-16 m-r-10"></i>${details}</a>`);
                    $("#lbreportcashcan").click();
                    toastr.success(res.message);
                } else toastr.error(res.message);
            }
        });
    });

    $(document).on("change", "#lowbdetails", function(){
        const s = $(this).val(), { id } = $(this).data();
        const sb = ['btn-warning', 'btn-info', 'btn-secondary', 'btn-dark', 'btn-primary', 'btn-success', 'btn-danger'];
        const api = ["lab_appoint_cancel", "lab_appoint_accept", "lab_appoint_ongoing", "lab_appoint_complete"]
        let setapi = '', bdata = {}, rs = '', as = '';
        bdata.id = id
        if (s == 2) {
            setapi = api[1]; rs = sb[0]; as = sb[1];
        } else if (s == 3) {
            $("#ladsnall").addClass("d-none");
            $("#ladhoul").removeClass("d-none");
        } else if (s == 4) {
            setapi = api[2]; rs = sb[2]; as = sb[3];
        } else if (s == 5) {
            $("#ladsnall").addClass("d-none");
            $("#ladotpdiv").removeClass("d-none");
        } else if (s == 6) {
            const cash = $(this).attr("data-cas");
            if (cash > 0) {
                $("#ladsnall").addClass("d-none");
                $("#ladcashdiv").removeClass("d-none");
            } else {
                setapi = api[3]; rs = sb[4]; as = sb[5];
            }
        } else if (s == 7) {
            $("#ladsnall").addClass("d-none");
            $("#larfcanceld").removeClass("d-none");
        }
        if (setapi != '') {
            const base_url = window.location.origin;
            $.ajax({
                url: base_url + '/lab/web/' + setapi,
                type: 'POST',
                dataType: 'JSON',
                data: bdata,
                success: function (res){
                    if (res.status == true) {
                        $(`#ladstatus`).removeClass(rs).addClass(as).text(res.title);
                        if (s == 2) {
                            if (res.ns == '3') {
                                $("#ladsnall").addClass("d-none");
                                $("#ladhoul").removeClass("d-none");
                            }
                            $('#lowbdetails option[value="7"]').remove();
                            $("#lastatus2").addClass("mtl1").removeClass("mtl").append(`<i class="fa fa-check-circle timeline-icon"></i>`).find(".f-w-400").text(res.time);
                        } else if (s == 4) {
                            $("#lastatus4").addClass("mtl1").removeClass("mtl").append(`<i class="fa fa-check-circle timeline-icon"></i>`).find(".f-w-400").text(res.time);
                        } else if (s == 6) {
                            $("#ladsnall").remove();
                            $("#ladcashdiv").remove();
                            $(".lrubtn1").each(function(){
                                $(this).addClass("d-none");
                            });
                            $(".lrubtn2").each(function(){
                                $(this).removeClass("d-none");
                            });
                            $(".larcancel").each(function(){
                                $(this).addClass("d-none");
                            });
                            $("#lastatus6").addClass("mtll1").removeClass("mtllast").append(`<i class="fa fa-check-circle timeline-icon"></i>`).find(".f-w-400").text(res.time);
                        }
                        toastr.success(res.message);
                    }  else toastr.error(res.message);
                }
            });
        }
    });

    $(document).on("click", "#ladhulsmbtn", function(){
        const { id } = $('#ladhulsmuser').data();
        const cul = $("#ladhulsmuser").val();
        if (cul != null) {
            const base_url = window.location.origin;
            $.ajax({
                url: base_url + '/lab/web/lab_appoint_assi_coll',
                type: 'POST',
                dataType: 'JSON',
                data: { id, cul },
                success: function (res){
                    if (res.status == true) {
                        $("#lowbdetails").select2().val("3").trigger("change");
                        $(`#ladstatus`).removeClass("btn-info").addClass("btn-secondary").text(res.title);
                        $("#ladsnall").removeClass("d-none");
                        $("#ladhoul").addClass("d-none");
                        $("#ladhuldiv").removeClass("d-none");
                        $("#ladhulname").text('').text(res.ull.name);
                        $("#ladhulemail").text('').text(res.ull.email);
                        $("#ladhulcphone").text('').text(res.ull.country_code + ' ' + res.ull.phone);
                        $("#lastatus3").addClass("mtl1").removeClass("mtl").append(`<i class="fa fa-check-circle timeline-icon"></i>`).find(".f-w-400").text(res.time);
                        toastr.success(res.message);
                    } else toastr.error(res.message);
                }
            });
        } else toastr.error('Please Select Home Collect User.');
    });

    $(document).on("click", "#ladinotpbtn", function(){
        const { id } = $(this).data();
        const otp = $("#otpinfield").val();
        if (otp != '') {
            $("#otpinfield").removeClass("is-invalid")
            const base_url = window.location.origin;
            $.ajax({
                url: base_url + '/lab/web/lab_appoint_inprogress',
                type: 'POST',
                dataType: 'JSON',
                data: { id, otp },
                success: function (res){
                    if (res.status == 4) {
                        $("#lowbdetails").val("5").trigger("change");
                        $(`#ladstatus`).removeClass("btn-dark").addClass("btn-primary").text(res.title);
                        $("#ladsnall").removeClass("d-none");
                        $("#ladotpdiv").addClass("d-none");
                        $(".lrubtn1").each(function(){
                            $(this).removeClass("d-none");
                        });
                        $(".lrubtn2").each(function(){
                            $(this).addClass("d-none");
                        });
                        $("#lastatus5").addClass("mtl1").removeClass("mtl").append(`<i class="fa fa-check-circle timeline-icon"></i>`).find(".f-w-400").text(res.time);
                        toastr.success(res.message);
                    } else {
                        $("#otpinfield").addClass("is-invalid");
                        toastr.error(res.message);
                    }
                }
            });
        } else {
            $("#otpinfield").addClass("is-invalid")
            toastr.error(res.message);
        }
    });

    $(document).on("change", "#ladcansel", function(){
        const selectedTitle = $('#ladcansel option:selected').data('title');
        if (selectedTitle && "other".match(new RegExp(selectedTitle, 'i'))) $("#lacaninp").removeClass("d-none");
        else $("#lacaninp").addClass("d-none");
        $("#clapcanreas").addClass("d-none");
    });

    $(document).on("click", "#lacanbtn", function(){
        const cul = $("#ladcansel").val(), { id } = $(this).data();
        let oth = '';
        const selectedTitle = $('#ladcansel option:selected').data('title');
        if (selectedTitle && "other".match(new RegExp(selectedTitle, 'i'))) {
            oth = $("#canothreason").val();
            if (oth == '') {
                toastr.error('Write Cancel Reason.');
                $("#canothreason").addClass("is-invalid");
                return
            }
        }
        if (cul) {
            $("#canothreason").removeClass("is-invalid");
            $("#ladcansel").removeClass("is-invalid");
            $("#clapcanreas").addClass("d-none");
            const base_url = window.location.origin;
            $.ajax({
                url: base_url + '/lab/web/lab_appoint_cancel',
                type: 'POST',
                dataType: 'JSON',
                data: {id, cul, oth},
                success: function (res){
                    if (res.status == true) {
                        $("#ladsnall").remove();
                        $(`#ladstatus`).removeClass("btn-warning").addClass("btn-danger").text(res.title);
                        $("#larfcanceld").addClass("d-none");
                        for (let i = 2; i <= 6; ) {
                            $(`#lastatus${i}`).remove();
                            i++;
                        }
                        $("#lastatus7").addClass("mtl1").removeClass("d-none").append(`<i class="fa fa-check-circle timeline-icon"></i>`).find(".f-w-400").text(res.time);
                        $("#lacancelreas").removeClass("d-none");
                        $("#ladcanreasn").text(res.oth == '' ? res.cancel_data[0].title : res.oth);
                        toastr.success(res.message);
                    } else toastr.error(res.message);
                }
            });
        } else {
            $("#ladcansel").addClass("is-invalid");
            $("#clapcanreas").removeClass("d-none");
            toastr.error('Please Select Cancel Reason.');
        }
    });

    $(document).on("click", "#ladfmidupre", function(){
        const current_row = $(this).parents(".mainlaup")
        const { pid, fid } = current_row.data();
        $("#laompid").val(pid);
        $("#laomfid").val(fid);
    });

    $(document).on("click", ".larcancel", function(){
        const current_row = $(this).parents(".mainlaup")
        const { id, pid, fid, d } = current_row.data();
        const base_url = window.location.origin;
        $.ajax({
            url: base_url + '/lab/web/lab_appoint_patientimg',
            type: 'POST',
            dataType: 'JSON',
            data: { id, pid, sfid:fid },
            success: function (res){
                if (res.status == true) {
                    let data = '';
                    $.each(res.images, function(index, value) {
                        const isImage = /\.(jpg|jpeg|png|gif|bmp)$/i.test(value);
                        if (isImage) {
                            data += `<div class="col-sm-12 col-md-6 col-lg-3 col-xl-3 text-center" id="larmaind">
                                        <img height="100" width="100" src="../../${value}" alt="">
                                        <span class="btn-danger px-3 b-r-5 f-14 f-w-400 mt-1 hand-hover drimag" data-img="${value}">${d}</span>
                                    </div>`;
                                    
                        } else {
                            data += ` <div class="col-sm-12 col-md-6 col-lg-3 col-xl-3 text-center" id="larmaind">
                                        <i class="fa fa-file-text-o font-secondary f-98"></i>
                                        <span class="btn-danger px-3 b-r-5 f-14 f-w-400 mt-1 hand-hover drimag" data-img="${value}">${d}</span>
                                    </div>`;
                        }
                    });
                    $("#ladromapid").val(id);
                    $("#ladrompid").val(pid);
                    $("#ladromfid").val(fid);
                    $(".vlarinmodel").html('');
                    $(".vlarinmodel").html(data);
                    toastr.success(res.message);
                } else toastr.error(res.message);
            }
        });
    });

    $(document).on("click", ".drimag", function(){
        const current = $(this).parents("#larmaind");
        const { img } = $(this).data();
        const id = $("#ladromapid").val();
        const pid = $("#ladrompid").val();
        const sfid = $("#ladromfid").val();
        const base_url = window.location.origin;
        $.ajax({
            url: base_url + '/lab/web/lab_appoint_deletelar',
            type: 'POST',
            dataType: 'JSON',
            data: { id, pid, sfid, img },
            success: function (res){
                if (res.status == true) {
                    current.remove();
                    $(`#lafmo${sfid}`).text(res.l);
                    if (res.l == 0) {
                        $(`#lafmd${sfid}`).text("");
                        $(`#lafmc${sfid}`).text("");
                        $(`#ladfrdel${sfid}`).addClass("d-none");
                        $("#lbreportc").click();
                    }
                    toastr.success(res.message);
                } else toastr.error(res.message);
            }
        });
    });

    $(document).on("click", "#ladcashbtn", function(){
        const { id } = $(this).data();
        const base_url = window.location.origin;
        $.ajax({
            url: base_url + '/lab/web/lab_appoint_complete',
            type: 'POST',
            dataType: 'JSON',
            data: { id },
            success: function (res){
                if (res.status == true) {
                    $("#ladsnall").remove();
                    $("#ladcashdiv").remove();
                    $(`#ladstatus`).removeClass("btn-primary").addClass("btn-success").text(res.title);
                    $(".lrubtn1").each(function(){
                        $(this).addClass("d-none");
                    });
                    $(".lrubtn2").each(function(){
                        $(this).removeClass("d-none");
                    });
                    $(".larcancel").each(function(){
                        $(this).addClass("d-none");
                    });
                    $("#lastatus6").addClass("mtll1").removeClass("mtllast").append(`<i class="fa fa-check-circle timeline-icon"></i>`).find(".f-w-400").text(res.time);
                    toastr.success(res.message);
                } else toastr.error(res.message);
            }
        });
    });

    $(document).on("change", "#ladschenge", function(){
        const s = $(this).val(), { id } = $(this).data();
        const sb = ['btn-warning', 'btn-secondary', 'btn-info', 'btn-success', 'btn-danger'];
        let setapi = '', bdata = {}, rs = '', as = '';
        bdata.id = id
        if (s == 5) {
            $("#ladmdiv").addClass("d-none");
            $("#larfcanceld").removeClass("d-none");
        } else if (s == 2) {
            $("#ladmdiv").addClass("d-none");
            $("#ladcindiv").removeClass("d-none");
        } else if (s == 3) {
            $("#ladmdiv").addClass("d-none");
            $("#dacoutdiv").removeClass("d-none");
        }
    });

    $(document).on("change", "#dacanreasl", function(){
        const selectedTitle = $('#dacanreasl option:selected').data('title');
        if (selectedTitle && "other".match(new RegExp(selectedTitle, 'i'))) $("#lacaninp").removeClass("d-none");
        else $("#lacaninp").addClass("d-none");
        $("#clapcanreas").addClass("d-none");
    });

    $(document).on("click", "#dacansubbtn", function(){
        const cul = $("#dacanreasl").val(), { id } = $(this).data();
        let oth = '';
        const selectedTitle = $('#dacanreasl option:selected').data('title');
        if (selectedTitle && "other".match(new RegExp(selectedTitle, 'i'))) {
            oth = $("#canothreason").val();
            if (oth == '') {
                toastr.error('Write Cancel Reason.');
                $("#canothreason").addClass("is-invalid");
                return
            }
        }
        if (cul) {
            $("#canothreason").removeClass("is-invalid");
            $("#dacanreasl").removeClass("is-invalid");
            $("#clapcanreas").addClass("d-none");
            const base_url = window.location.origin;
            $.ajax({
                url: base_url + '/booking/cancel_appointment',
                type: 'POST',
                dataType: 'JSON',
                data: {id, cul, oth},
                success: function (res){
                    if (res.status == true) {
                        $("#ladsnall").remove();
                        $(`#ladstatus`).removeClass("btn-warning").addClass("btn-danger").text(res.title);
                        $("#larfcanceld").addClass("d-none");
                        $("#docancelreas").removeClass("d-none");
                        $("#docanreasn").text(res.oth == '' ? res.cancel_data[0].title : res.oth);
                        toastr.success(res.message);
                    } else toastr.error(res.message);
                }
            });
        } else {
            $("#dacanreasl").addClass("is-invalid");
            $("#clapcanreas").removeClass("d-none");
            toastr.error('Please Select Cancel Reason.');
        }
    });

    $(document).on("click", "#ladcinbtn", function(){
        const { id } = $(this).data();
        const otp = $("#ladcinfield").val();
        if (otp != '') {
            $("#ladcinfield").removeClass("is-invalid");
            const base_url = window.location.origin;
            $.ajax({
                url: base_url + '/booking/start_treatment',
                type: 'POST',
                dataType: 'JSON',
                data: { id, otp },
                success: function (res){
                    if (res.status == true) {
                        $("#ladschenge").val("2").trigger("change");
                        $(`#ladstatus`).removeClass("btn-warning").addClass("btn-secondary").text(res.title);
                        $("#ladcindiv").addClass("d-none");
                        $("#ladmdiv").removeClass("d-none");
                        $("#davitphy").removeClass("disabled");
                        $("#dadrpres").removeClass("disabled");
                        $("#dadiagtest").removeClass("disabled");
                        $("#dapatiin").removeClass("disabled");

                        $("#dafmmfow").attr("data-fid", $("#damainfms").attr("data-fid"));
                        $("#dafmmfow").attr("data-s", 2);
                        $("#dafmmfow").attr("data-das", 1);
                        $("#damainfms").removeClass("border border-gray").addClass("b-primary")

                        $("#datottimediv").removeClass("d-none");
                        $("#damainstartt").removeClass("d-none");
                        $("#dasttext").text(res.time);
                        
                        toastr.success(res.message);
                    } else {
                        $("#ladcinfield").addClass("is-invalid");
                        toastr.error(res.message);
                    }
                }
            });
        } else {
            toastr.error('Please Enter OTP.');
            $("#ladcinfield").addClass("is-invalid");
        }
    });

    function ChangeDocAppoint(check, title, time) {
        if (check == 4) {
            $("#ladschenge").val("4").trigger("change");
            $(`#ladstatus`).removeClass("btn-secondary").addClass("btn-success").text(title);
            $("#dacoutdiv").remove();
            $("#ladmdiv").remove();
            $("#ladcashdiv").remove();
        } else {
            $("#ladschenge").val("3").trigger("change");
            $(`#ladstatus`).removeClass("btn-secondary").addClass("btn-primary").text(title);
            $("#dacoutdiv").addClass("d-none");
            $("#ladcashdiv").removeClass("d-none");
        }
        $(`.dafm`).each(function(){
            $(this).removeClass("b-primary").addClass("border border-gray");
        });
        $("#davptsu").removeClass("text-success").addClass("text-dark");
        $("#dasepr").removeClass("text-success").addClass("text-dark");
        $("#dadite").removeClass("text-success").addClass("text-dark");

        $("#davitphy").addClass("disabled");
        $("#dadrpres").addClass("disabled");
        $("#dadiagtest").addClass("disabled");
        $("#dapatiin").addClass("disabled");
        
        $("#dafmmfow").attr("data-fid", 0);
        $("#dafmmfow").attr("data-s", 3);
        $("#dafmmfow").attr("data-das", 0);

        if (time != '') {
            $("#datottimediv").removeClass("d-none");
            $("#damainentt").removeClass("d-none");
            $("#daettext").text(time);
        }
    } 

    $(document).on("click", "#ladcoutbtn", function(){
        const { id } = $(this).data();
        const otp = $("#ladcoutfield").val();
        if (otp != '') {
            const base_url = window.location.origin;
            $.ajax({
                url: base_url + '/booking/check_paid_status',
                type: 'POST',
                dataType: 'JSON',
                data: { id, otp },
                success: function (res){
                    if (res.status == true) {
                        $("#ladcoutfield").removeClass("is-invalid");
                        if (res.check == 3) {
                            ChangeDocAppoint(res.check, res.title, res.time);
                            toastr.success(res.message);
                        } else {
                            const base_url = window.location.origin;
                            $.ajax({
                                url: base_url + '/booking/end_treatment',
                                type: 'POST',
                                dataType: 'JSON',
                                data: { id, otp },
                                success: function (eres){
                                    if (eres.status == true) {
                                        ChangeDocAppoint(eres.check, eres.title, res.time);
                                        toastr.success(eres.message);
                                    } else {
                                        $("#ladcoutfield").addClass("is-invalid");
                                        toastr.error(eres.message);
                                    }
                                }
                            });
                        }
                    } else {
                        $("#ladcoutfield").addClass("is-invalid");
                        toastr.error(res.message);
                    }
                }
            });
        } else {
            toastr.error('Please Enter OTP.');
            $("#ladcoutfield").addClass("is-invalid")
        }
    });

    $(document).on("click", "#daccashbtn", function(){
        const { id } = $(this).data();
        const base_url = window.location.origin;
        $.ajax({
            url: base_url + '/booking/end_treatment',
            type: 'POST',
            dataType: 'JSON',
            data: { id, otp: 0 },
            success: function (res){
                if (res.status == true) {
                    ChangeDocAppoint(res.check, res.title, res.time);
                    toastr.success(eres.message);
                } else {
                    $("#ladcoutfield").addClass("is-invalid");
                    toastr.error(eres.message);
                }
            }
        });
    });

    $(document).on("click", "#damainfms", function(){
        const { fid, id } = $(this).data(), current = $(this);
        const base_url = window.location.origin;
        $.ajax({
            url: base_url + '/booking/check_upload_details',
            type: 'POST',
            dataType: 'JSON',
            data: { id, fid },
            success: function (res){
                if (res.status == true) {
                    res.vp == 1 ? $("#davptsu").removeClass("text-dark").addClass("text-success") : $("#davptsu").removeClass("text-success").addClass("text-dark");
                    res.dp == 1 ? $("#dasepr").removeClass("text-dark").addClass("text-success") : $("#dasepr").removeClass("text-success").addClass("text-dark");
                    res.dt == 1 ? $("#dadite").removeClass("text-dark").addClass("text-success") : $("#dadite").removeClass("text-success").addClass("text-dark");
                    $(`.dafm`).each(function(){
                        $(this).removeClass("b-primary").addClass("border border-gray");
                    });
                    $(current).removeClass("border border-gray").addClass("b-primary");
                    $("#dafmmfow").attr("data-fid", fid);
                    toastr.success(res.message);
                } else toastr.error(res.message);
            }
        });
    });

    $(document).on("click", "#dapatiin", function(){
        const fid = $("#dafmmfow").attr("data-fid"), id = $("#dafmmfow").attr("data-id"), s = $("#dafmmfow").attr("data-s"), das = $("#dafmmfow").attr("data-das");
        
        // if (s == 2 && das == 1) {
            const base_url = window.location.origin;
            $.ajax({
                url: base_url + '/booking/patient_info_details',    
                type: 'POST',
                dataType: 'JSON',
                data: { id, fid },
                success: function (res){
                    if (res.status == true) {
                        $("#dafmprofile").attr("src", "../../"+res.fm.profile_image);
                        $("#dafnamefield").text(res.fm.name);
                        $("#dafgender").text(res.fm.gender);
                        $("#dafage").text(res.fm.patient_age);
                        $("#dafnote").text(res.ap.health_concern);
                        let data = '';
                        $.each(res.ap.document, function(index, value){
                            const isImage = /\.(jpg|jpeg|png|gif|bmp)$/i.test(value);
                            if (isImage) {
                                data += `<div class="col-auto">
                                            <img class="b-r-5" height="110" width="100" src="../../${value}" alt="Document"
                                                style="user-drag: none; user-select: none; pointer-events: none; display: block;">
                                            <div class="img_footer hand-hover" id="dappdoen" data-img="../../${value}">Download</div>
                                        </div>`;
                            } else {
                                data += `<div class="col-auto">
                                            <img class="b-r-5" height="110" width="100" src="../../images/Group.png" alt="Document"
                                                style="user-drag: none; user-select: none; pointer-events: none; display: block;">
                                            <div class="img_footer hand-hover" id="dappdoen" data-img="../../${value}">Download</div>
                                        </div>`;
                            }
                        });
                        $("#dafmpetidoc").html("");
                        $("#dafmpetidoc").html(data);
                        $("#pet_hel_concern").modal("show");
                        // toastr.success(res.message);
                    } else toastr.error(res.message);
                }
            });
        // } else toastr.error('Complete Other Step!');
    });

    $(document).on("click", "#dappdoen", function(){
        let img = $(this).attr("data-img");
        const filename = img.split('/').pop();
        fetch(img)
            .then(res => res.blob())
            .then(blob => {
                const blobUrl = window.URL.createObjectURL(blob);
                const a = document.createElement("a");
                a.href = blobUrl;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                window.URL.revokeObjectURL(blobUrl);
            })
            .catch(err => {
                console.error("Download failed:", err);
                alert("Download failed");
            });
    });

    $(document).on("input", "#dafreqsetup", function(){
        let val = $(this).val().replace(/\+/g, '');
        let formatted = val.split('').join('+');
        $(this).val(formatted);
    })

    $(document).on("input", "#edafreqsetup", function(){
        let val = $(this).val().replace(/\+/g, '');
        let formatted = val.split('').join('+');
        $(this).val(formatted);
    })

    $(document).on("click", "#davitphy", function(){
        const fid = $("#dafmmfow").attr("data-fid"), id = $("#dafmmfow").attr("data-id"), s = $("#dafmmfow").attr("data-s"), enter = $("#dafmmfow").attr("data-enter"), das = $("#dafmmfow").attr("data-das");
        
        // if (s == 2 && das == 1) {
            const base_url = window.location.origin;
            $.ajax({
                url: base_url + '/booking/vituals_physical_details',
                type: 'POST',
                dataType: 'JSON',
                data: { id, fid },
                success: function (res){
                    if (res.status == true) {
                        let data = '';
                        $.each(res.vitphy, function(index, value){
                            data += `<div class="col-12">
                                        <label class="col-form-label">${value.title}</label>
                                        <input class="form-control" type="text" name="vplist" value="${value.text}" placeholder="${enter} ${value.title}" ${res.admin_role == 1 ? 'readonly' : '' }>
                                        <input type="hidden" name="vpidlist" value="${value.id}">
                                    </div>`;
                        });
                        if (data != '') {
                            $("#virphydata").html("");
                            $("#virphydata").html(data);
                            $("#uppetiheal").attr("data-fid", fid);
                            $("#virphymodal").modal("show");
                        }
                        // toastr.success(res.message);
                    } else toastr.error(res.message);
                }
            }); 
        // } else toastr.error('Complete Other Step!');
    });

    $(document).on("click", "#uppetiheal", function(e){
        e.preventDefault();
        const s = $("#dafmmfow").attr("data-s")
        if (s == 2) {
            const fid = $(this).attr("data-fid"), id = $(this).attr("data-id");
            let fullist = [];
            $('input[name="vplist"]').each(function() {
                if ($(this).val() != '') {
                    let vp = $(this).siblings('input[name="vpidlist"]').val();
                    fullist.push({id: vp, text: $(this).val() });
                }
            });
            // alert(fullist[0])
            if (fullist != '') {
                const base_url = window.location.origin;
                $.ajax({
                    url: base_url + '/booking/add_vit_phy_data',
                    type: 'POST',
                    dataType: 'JSON',
                    data: { id, fid, fullist: JSON.stringify(fullist) },
                    success: function (res){
                        if (res.status == true) {
                            $("#davptsu").removeClass("text-dark").addClass("text-success");
                            $("#virphymodal").modal("hide");
                            $("#virphydata").html("");
                            toastr.success(res.message);
                        } else toastr.error(res.message);
                    }
                });
            }
        }
    });

    $(document).on("click", "#dadrpres", function(e){
        const fid = $("#dafmmfow").attr("data-fid"), id = $("#dafmmfow").attr("data-id"), s = $("#dafmmfow").attr("data-s"), das = $("#dafmmfow").attr("data-das");
        // if (das == 1 && s == 2) {
            window.location.href = `/booking/drugs_prescription_info?id=${id}&fid=${fid}`;
        // } else toastr.error('Complete Other Step!');
    });

    $('#drugprescrimodel').on('shown.bs.modal', function () {
        $('#lab_code').select2({
            dropdownParent: $('#drugprescrimodel')
        });
    });

    $(document).on("click", "#addurpreadmo", function(e){
        e.preventDefault();
        const { fid, id, s } = $(this).data();
        let check = 0;
        $(".druprec").each(function(cval){
            if ($(this).val() == "" || $(this).val() == null) check++;
        });
        if (check == 0) {
            $("#edit_detail_error").addClass("d-none");
            if (s == 2 ) {
                let formData = `id=${id}&fid=${fid}&dpid=&` + $('#drugs_pres_form').serialize();
                const base_url = window.location.origin;
                $.ajax({
                    url: base_url + '/booking/update_drug_prescription',
                    type: 'POST',
                    data: formData,
                    success: function (res){
                        if (res.status == true) {
                            let d = res.dp;
                            if ($.fn.DataTable.isDataTable('#basic-1')) {
                                $('#basic-1').DataTable().destroy();
                            }
                            let rowData = `<tr id="edupr${d.id}">
                                            <td class="d-none">${d.id}</td>
                                            <td>${d.medi}</td>
                                            <td>${d.type}</td>
                                            <td>${d.Dosage}</td>
                                            <td>${d.Days}</td>
                                            <td>${d.Time}</td>
                                            <td>${d.Frequency}</td>
                                            <td>
                                                <ul class="action"> 
                                                    <li class="edit"><a id="edit_dru_pre" data-id="${d.id}" data-mid="${d.mid}" data-type="${d.type}" data-dosage="${d.Dosage}" 
                                                        data-days="${d.Days}" data-time="${d.Time}" data-frequency="${d.Frequency}" data-instructions="${d.Instructions}">
                                                        <i class="icon-pencil-alt"></i></a></li>
                                                    <li class="delete"><a id="dadpdelete" data-id="${id}" data-fid="${fid}" data-d_id="${d.id}"><i class="icon-trash"></i></a></li>
                                                </ul>
                                            </td>
                                        </tr>`;
                            $(".mdadrpredata").prepend(rowData);
                            $('#basic-1').DataTable({ "responsive": true, "paging": true, "searching": true, "info": true });
                            $("#drugprescrimodel").modal("hide");
                            $(".druprec").each(function(cval){
                                $(this).val("") == ""
                            });
                            toastr.success(res.message);
                        } else toastr.error(res.message);
                    }
                }); 
            }
        } else $("#edit_detail_error").removeClass("d-none");
    });

    $(document).on("click", "#edit_dru_pre", function(){
        const { id, mid, type, dosage, days, time, frequency, instructions } = $(this).data();
        $("#eddadsel").select2().val(mid).trigger("change");
        $("#edtype").val(type);
        $("#edafreqsetup").val(frequency);
        $("#eddosage").val(dosage);
        $("#eddays").val(days);
        $("#edtime").val(time);
        $("#edinstruction").val(instructions);
        $("#edit_dpmodal").modal("show")
        $("#edadpdpid").val(id);
    });

    $(document).on("click", "#editurpreadmo", function(e){
        e.preventDefault();
        const { fid, id, s } = $(this).data();
        let check = 0;
        $(".edruprec").each(function(cval){
            if ($(this).val() == "" || $(this).val() == null) check++;
        });
        if (s == 2 ) {
            let formData = `id=${id}&fid=${fid}&` + $('#edtdrugs_pres_form').serialize();
            const base_url = window.location.origin;
            $.ajax({
                url: base_url + '/booking/update_drug_prescription',
                type: 'POST',
                data: formData,
                success: function (res){
                    if (res.status == true) {
                        let d = res.dp;
                        if ($.fn.DataTable.isDataTable('#basic-1')) {
                            $('#basic-1').DataTable().destroy();
                        }
                        let data = `<td class="d-none">${d.id}</td>
                                    <td>${d.medi}</td>
                                    <td>${d.type}</td>
                                    <td>${d.Dosage}</td>
                                    <td>${d.Days}</td>
                                    <td>${d.Time}</td>
                                    <td>${d.Frequency}</td>
                                    <td>
                                        <ul class="action"> 
                                            <li class="edit"><a id="edit_dru_pre" data-id="${d.id}" data-mid="${d.mid}" data-type="${d.type}" data-dosage="${d.Dosage}" 
                                                data-days="${d.Days}" data-time="${d.Time}" data-frequency="${d.Frequency}" data-instructions="${d.Instructions}">
                                                <i class="icon-pencil-alt"></i></a></li>
                                            <li class="delete"><a id="dadpdelete" data-id="${id}" data-fid="${fid}" data-d_id="${d.id}"><i class="icon-trash"></i></a></li>
                                        </ul>
                                    </td>`;
                        $(`#edupr${d.id}`).html("").html(data);
                        $('#basic-1').DataTable({ "responsive": true, "paging": true, "searching": true, "info": true });
                        $("#edit_dpmodal").modal("hide");
                        $(".edruprec").each(function(cval){
                            $(this).val("") == ""
                        });
                        toastr.success('Drugs & Prescription Detail Update Successfully.');
                    } else toastr.error('Something went wrong!');
                }
            }); 
        }
    });

    $(document).on("click", "#dadpdelete", function(e){
        const { fid, id, d_id } = $(this).data();
        const base_url = window.location.origin;
        $.ajax({
            url: base_url + '/booking/delete_drug_prescription',
            type: 'POST',
            dataType: 'JSON',
            data: { fid, id, d_id },
            success: function (res){
                if (res.status == true) {
                    if ($.fn.DataTable.isDataTable('#basic-1')) {
                        $('#basic-1').DataTable().destroy();
                    }
                    $(`#edupr${res.d_id}`).remove();
                    $('#basic-1').DataTable({ "responsive": true, "paging": true, "searching": true, "info": true });
                    toastr.success(res.message);
                } else toastr.error(res.message);
            }
        }); 
    });

    $(document).on("click", "#dadiagtest", function(e){
        const fid = $("#dafmmfow").attr("data-fid"), id = $("#dafmmfow").attr("data-id"), das = $("#dafmmfow").attr("data-das")
        // if (das == 1) {
            const base_url = window.location.origin;
            $.ajax({
                url: base_url + '/booking/doc_appo_diagnosis_list',
                type: 'POST',
                dataType: 'JSON',
                data: { fid, id },
                success: function (res){
                    if (res.status == true) {
                        let data = ''
                        $.each(res.diagnosis, function(index, value){
                            data += `<div class="row border border-dark b-r-5 py-2 hand-hover ${index != 0 ? 'mt-2' : ''}" id="${res.admin_role == 3 ? 'checkdadt' : 'disabled' }">
                                        <div class="col-2 itemmixcenter">
                                            <div class="svgimgstyle">
                                                <svg width="24" height="24" viewBox="0 0 24 24" fill="5c61f1" xmlns="http://www.w3.org/2000/svg">
                                                    <path fill-rule="evenodd" clip-rule="evenodd" d="M12.4744 3.24267C12.8611 2.85596 13.4881 2.85596 13.8748 3.24267L20.7571 10.1251C21.1439 10.5118 21.1439 11.1387 20.7571 11.5255C20.3704 11.9122 19.7435 11.9122 19.3567 11.5255L12.4744 4.64307C12.0877 4.25636 12.0877 3.62938 12.4744 3.24267ZM17.03 3.65682C17.9449 2.74193 19.4282 2.74193 20.3431 3.65682C21.258 4.57171 21.258 6.05504 20.3431 6.96993L20 7.31301L16.6869 3.9999L17.03 3.65682ZM12.5303 6.50002L17.5 11.4697L15.7457 13.224L6.63459 12.3957L12.5303 6.50002ZM5.25391 13.7764L14.365 14.6047L8.74721 20.2224C7.37487 21.5948 5.14988 21.5947 3.77754 20.2224C2.40521 18.8501 2.40521 16.6251 3.77755 15.2527L5.25391 13.7764Z" fill="#0202f9"/>
                                                </svg>
                                            </div>
                                        </div>
                                        <div class="col-9 itemcenter">
                                            <div>
                                                <span class="f-w-500 f-14">${value.name}</span>
                                                <p class="mainsprice mb-0">${value.description}</p>
                                            </div>
                                        </div>
                                        <div class="col-1 itemmixcenter">
                                            <input class="checkbox_animated dadtcb reada" id="chk-ani" data-id="${value.id}" type="checkbox" ${value.status == 1 ? 'checked' : ''} ${res.admin_role == 1 ? 'disabled' : '' }>
                                        </div>
                                    </div>`;
                        });
                        
                        $("#dadiagtestlist").html("").html(data);
                        $("#diagnosistestmodal").modal("show");
                        // toastr.success(res.message);
                    } else toastr.error(res.message);
                }
            }); 
        // } else toastr.error('Complete Other Step!');
    });

    $(document).on("click", ".dadtcb", function(event) {
        event.stopPropagation();
    });

    $(document).on("click", "#checkdadt", function(){
        const checkbox = $(this).find(".dadtcb");
        checkbox.prop("checked", !checkbox.prop("checked"));
    });

    $(document).on("click", "#dadiagnobtn", function(){
        let fid = $("#dafmmfow").attr("data-fid"), id = $("#dafmmfow").attr("data-id"), dtdata = [];
        $(".reada").each(function(){
            if ($(this).prop("checked")) {
                dtdata.push($(this).attr("data-id"));
            }
        });
        const base_url = window.location.origin;
        $.ajax({
            url: base_url + '/booking/web_add_appo_diagnosis',
            type: 'POST',
            contentType: 'application/json',
            traditional: true,
            data: JSON.stringify({ fid, id, dtdata }),
            success: function (res){
                if (res.status == true) {
                    if (res.check == 1) $("#dadite").removeClass("text-success").addClass("text-dark");
                    else $("#dadite").removeClass("text-dark").addClass("text-success");
                    $("#diagnosistestmodal").modal("hide");
                    $("#dadiagtestlist").html("");
                    toastr.success(res.message);
                } else toastr.error(res.message);
            }
        }); 
    });

    $(document).on("change", "#dpostachan", function(){
        const s = $(this).val(), { id } = $(this).data();
        const sb = ['btn-secondary', 'btn-info', 'btn-primary', 'btn-success'];
        let setapi = '', bdata = {}, rs = '', as = '';
        bdata.id = id; bdata.s = s;

        if (s == 1) {
            rs = sb[0]; as = sb[1];
        } else if (s == 2) {
            rs = sb[1]; as = sb[2];
        } else if (s == 3) {
            rs = sb[2]; as = sb[3];
        } else if (s == 4) {
            $("#dobmd").addClass("d-none");
            $("#larfcanceld").removeClass("d-none");
        }
        if (rs != '') {
            const base_url = window.location.origin;
            $.ajax({
                url: base_url + '/user/doctor_order_status_change',
                type: 'POST',
                dataType: 'JSON',
                data: bdata,
                success: function (res){
                    if (res.status == true) {
                        $(`#dpostatus`).removeClass(rs).addClass(as).text(res.title);
                        if (s == 3) {
                            $("#larfcanceld").remove();
                            $("#dobmd").remove();
                        }
                        toastr.success(res.message);
                    } else toastr.error(res.message);
                }
            });
        }
    });

    $(document).on("change", "#dpocansel", function(){
        const selectedTitle = $('#dpocansel option:selected').data('title');
        if (selectedTitle && "other".match(new RegExp(selectedTitle, 'i'))) $("#docaninp").removeClass("d-none");
        else $("#docaninp").addClass("d-none");
        $("#clapcanreas").addClass("d-none");
    });

    $(document).on("click", "#dpocanbtn", function(){
        const cul = $("#dpocansel").val(), { id } = $(this).data();
        let oth = '';
        const selectedTitle = $('#dpocansel option:selected').data('title');
        if (selectedTitle && "other".match(new RegExp(selectedTitle, 'i'))) {
            oth = $("#canothreason").val();
            if (oth == '') {
                toastr.error('Write Cancel Reason.');
                $("#canothreason").addClass("is-invalid");
                return
            }
        }
        if (cul) {
            $("#canothreason").removeClass("is-invalid");
            $("#dpocansel").removeClass("is-invalid");
            $("#clapcanreas").addClass("d-none");
            const base_url = window.location.origin;
            $.ajax({
                url: base_url + '/user/doc_order_cancel',
                type: 'POST',
                dataType: 'JSON',
                data: {id, cul, oth},
                success: function (res){
                    if (res.status == true) {
                        $("#larfcanceld").remove();
                        $("#dobmd").remove();
                        $(`#dpostatus`).removeClass("btn-secondary").addClass("btn-danger").text(res.title);
                        $("#dpocancelreas").removeClass("d-none");
                        $("#dpocanreasn").text(res.oth == '' ? res.cancel_data[0].title : res.oth);
                        toastr.success(res.message);
                    } else toastr.error(res.message);
                }
            });
        } else {
            $("#dpocansel").addClass("is-invalid");
            $("#clapcanreas").removeClass("d-none");
            toastr.error('Please Select Cancel Reason.');
        }
    });

    $(document).on("click", '#chat_user', function(){
        if ($(this).hasClass("chat_background") === false) {
            
            $(".chat_div").each(function() {
                $(this).removeClass("chat_background");
            });
            
            $(this).addClass("chat_background");
    
            $(this).find("#new_message").addClass("d-none");
            let { sender, reciver } = $(this).data();
            
            const base_url = window.location.origin;
            $.ajax({
                url: base_url + '/chat/chat_list',
                type: 'POST',
                dataType: 'JSON',
                data: {sender, reciver},
                success: function (res){
                    
                    $("#chat_profile_user").html("").html(res.user[0].name);
                    $("#chat_profile_time").html("").html('Last Message ' + res.last_data);
                    $("#senderu_id").val("").val(res.send_id);
                    $("#lmcdcd").val("").val(res.all_chat.at(-1).date);
                    $("#chat_detail").html("");
                    
                    $.each(res.all_chat, function(index, value){
                        let dateHTML = ""
                        dateHTML = '<li class="text-center my-2">'+
                                        '<span class="f-w-500">'+ value.date +'</span>'+
                                    '</li>';
                        $.each(value.chat, function(i, time){
                            if (time.status === 1 ) {
                                
                                dateHTML += `<li class="clearfix">
                                                <div class="message other-message pull-right py-1 mb-1 chat_background costycls">
                                                    <div class="message-data m-0"><span class="message-data-time">${time.date}</span></div>${time.message.replace(/\n/g, '<br>')}
                                                </div>
                                            </li>`;
                            } else {
                                dateHTML += `<li>
                                                <div class="message my-message py-1 mb-1 costycls">
                                                    <div class="message-data text-end m-0"><span class="message-data-time">${time.date}</span></div>${time.message.replace(/\n/g, '<br>')}
                                                </div>
                                            </li>`
                            }
                        });
                        dateHTML += '</div>';
                        $("#chat_detail").append(dateHTML);
                    });
                    let chatDetail = document.getElementById('scrollbottom');
                    chatDetail.scrollTop = chatDetail.scrollHeight;
                }
            });
        }
    });

    $('#chatSearchInput').on('keyup', function () {
        let filter = $(this).val().toLowerCase();
        $('.chat_div').each(function () {
            let name = $(this).data('name');
            if (name.includes(filter)) {
                $(this).removeClass("d-none");
            } else {
                $(this).addClass("d-none");
            }
        });
    });

    $(document).on('click', '#dwpareq', function(){
        const base_url = window.location.origin;
        $.ajax({
            url: base_url + '/user/doc_withd_data',
            type: 'POST',
            dataType: 'JSON',
            success: function (res){
                if (res.status == true) {
                    $("#dwmwaid").text(res.doctor[0].tot_payout);
                    $("#dmwmodelwam").text(res.doctor[0].d_min_withdraw);
                    $("#paymentsucc").modal("show");
                    currency()
                    thousands_separators()
                }
            }
        });        
    });
    
    $(document).on('input', '.dwainput', function(){
        let amount = $(this).val();
        const { wa, mwa } = $("#dwpareq").data();
        if (parseFloat(wa) >= parseFloat(mwa)) {
            if (parseFloat(amount) < parseFloat(mwa)) {
                $("#clapcanreas").removeClass('d-none').text('').text(`Minimum Withdrawal Amount ${mwa}`);
                return;
            }
            if (parseFloat(amount) > parseFloat(wa)) {
                $("#clapcanreas").removeClass('d-none').text('').text(`Maximum Withdrawal Amount ${wa}`);
                return;
            }
            $("#clapcanreas").addClass('d-none').text('');
        } else {
            $("#clapcanreas").removeClass('d-none').text('').text(`Minimum Withdrawal Amount ${mwa}`);
        }
    });

    $(document).on('change', '#dwptcid', function(){
        let value = $(this).val()
        $('#payment_data').html('')
        if (value == "1") {
            $('#payment_data').html(
                '<label class="col-form-label">UPI Id</label>'+
                '<input class="form-control dwinc" type="text" name="upi_id" placeholder="Enter UPI Id" required>'
            );
        } else if(value == "2") {
            $('#payment_data').html(
                '<label class="col-form-label">Paypal Email Id</label>'+
                '<input class="form-control dwinc" type="text" name="paypal_id" placeholder="Enter Paypal Id" required>'
            ); 
        } else if(value == "3") {
            $('#payment_data').html(
                '<label class="col-form-label">Bank Account No</label>'+
                '<input class="form-control dwinc" type="number" name="bank_no" placeholder="Enter Paypal Email Id" required>'+
                '<label class="col-form-label">IFSC Code</label>'+
                '<input class="form-control dwinc" type="text" name="bank_ifsc" placeholder="Enter IFSC Code" required>'+
                '<label class="col-form-label">Bank Account Type</label>'+
                '<input class="form-control dwinc" type="text" name="bank_type" placeholder="Enter Account Type" required>'
            );
        }
    })

    $(document).on('click', '#dwwithbtnc', function(){
        let amount = $(".dwainput").val();
        const { wa, mwa } = $("#dwpareq").data();
        if (parseFloat(wa) >= parseFloat(mwa)) {
            if (parseFloat(amount) < parseFloat(mwa)) {
                $("#clapcanreas").removeClass('d-none').text('').text(`Minimum Withdrawal Amount ${mwa}`);
                return;
            }
            if (parseFloat(amount) > parseFloat(wa)) {
                $("#clapcanreas").removeClass('d-none').text('').text(`Maximum Withdrawal Amount ${wa}`);
                return;
            }
            $("#clapcanreas").addClass('d-none').text('');
            let checki = 0, otherc = 0;
            $(".dwinc").each(function(){
                otherc++;
                if ($(this).val() == 0 || $(this).val() == '' || $(this).val() == null) checki++;
            });
            
            if (checki == 0 && otherc > 2) {    
                $("#detail_error").addClass("d-none");
                $("#dwawform").submit();
            } else {
                $("#detail_error").removeClass("d-none");
            }
        } else {
            $("#clapcanreas").removeClass('d-none').text('').text(`Minimum Withdrawal Amount ${mwa}`);
        }
    });

    $(document).on('click', '#ccatwab', function(){
        const base_url = window.location.origin;
        $.ajax({
            url: base_url + '/user/doc_cash_wbalance',
            type: 'POST',
            dataType: 'JSON',
            success: function (res){
                if (res.status == true) {
                    $("#dxtcatot").text(res.doctor[0].cash_amount);
                    $("#paymentsucc").modal("show");
                    $("#dcabwbtn").attr("data-cab", res.doctor[0].cash_amount)
                    currency()
                    thousands_separators()
                }
            }
        });        
    });

    $(document).on('input', '.dcawinput', function(){
        let amount = $(this).val(), casha = $("#dcabwbtn").attr("data-cab");
        if (Number(amount) > Number(casha) || amount == 0 || isNaN(amount)) $("#dcwinperror").removeClass('d-none');
        else $("#dcwinperror").addClass('d-none');
    });

    $(document).on('click', '#dcabwbtn', function(){
        let inpc = 0;
        $(".dwinc").each(function(){
            if ($(this).val() == '' || $(this).val() == 0 || $(this).val() == null) inpc++
        });

        if (inpc == 0) {
            $("#detail_error").addClass("d-none");

            let amount = $("#dwcashimput").val(), casha = $('#dcabwbtn').attr("data-cab");
            if (Number(amount) > Number(casha) || amount == 0 || isNaN(amount)) $("#dcwinperror").removeClass('d-none');
            else {
                $("#dcwinperror").addClass('d-none');
                $("#dwawform").submit();
            }
            
        } else $("#detail_error").removeClass("d-none");
    });

    $(document).on('click', '#dppwpareq', function(){
        const base_url = window.location.origin;
        $.ajax({
            url: base_url + '/user/doc_dwpay_data',
            type: 'POST',
            dataType: 'JSON',
            success: function (res){
                if (res.status == true) {
                    // const { wa, mwa } = $(this).data();
                    $("#dwmwaid").text(res.doctor[0].medicine_payout);
                    $("#dmwmodelwam").text(res.doctor[0].d_min_withdraw);
                    $("#paymentsucc").modal("show");
                    currency()
                    thousands_separators()
                }
            }
        });
    });
    
    $(document).on('input', '.dpwainput', function(){
        let amount = $(this).val();
        const { wa, mwa } = $("#dppwpareq").data();
        if (parseFloat(wa) >= parseFloat(mwa)) {
            if (parseFloat(amount) < parseFloat(mwa)) {
                $("#clapcanreas").removeClass('d-none').text('').text(`Minimum Withdrawal Amount ${mwa}`);
                return;
            }
            if (parseFloat(amount) > parseFloat(wa)) {
                $("#clapcanreas").removeClass('d-none').text('').text(`Maximum Withdrawal Amount ${wa}`);
                return;
            }
            $("#clapcanreas").addClass('d-none').text('');
        } else {
            $("#clapcanreas").removeClass('d-none').text('').text(`Minimum Withdrawal Amount ${mwa}`);
        }
    });

    $(document).on('click', '#dpwpwithbtnc', function(){
        let amount = $(".dpwainput").val();
        const { wa, mwa } = $("#dppwpareq").data();
        if (parseFloat(wa) >= parseFloat(mwa)) {
            if (parseFloat(amount) < parseFloat(mwa)) {
                $("#clapcanreas").removeClass('d-none').text('').text(`Minimum Withdrawal Amount ${mwa}`);
                return;
            }
            if (parseFloat(amount) > parseFloat(wa)) {
                $("#clapcanreas").removeClass('d-none').text('').text(`Maximum Withdrawal Amount ${wa}`);
                return;
            }
            $("#clapcanreas").addClass('d-none').text('');
            let checki = 0, otherc = 0;
            $(".dwinc").each(function(){
                otherc++;
                if ($(this).val() == 0 || $(this).val() == '' || $(this).val() == null) checki++;
            });
            
            if (checki == 0 && otherc > 2) {    
                $("#detail_error").addClass("d-none");
                $("#dppwawform").submit();
            } else {
                $("#detail_error").removeClass("d-none");
            }
        } else {
            $("#clapcanreas").removeClass('d-none').text('').text(`Minimum Withdrawal Amount ${mwa}`);
        }
    });

    $(document).on('click', '#lwpareq', function(){
        const base_url = window.location.origin;
        $.ajax({
            url: base_url + '/lab/lab_withd_data',
            type: 'POST',
            dataType: 'JSON',
            success: function (res){
                if (res.status == true) {
                    $("#dwmwaid").text(res.lab[0].tot_payout);
                    $("#dmwmodelwam").text(res.lab[0].lab_min_withdraw);
                    $("#paymentsucc").modal("show");
                    currency();
                    thousands_separators();
                }
            }
        });        
    });
    
    $(document).on('input', '.lwainput', function(){
        let amount = $(this).val();
        const { wa, mwa } = $("#lwpareq").data();
        if (parseFloat(wa) >= parseFloat(mwa)) {
            if (parseFloat(amount) < parseFloat(mwa)) {
                $("#clapcanreas").removeClass('d-none').text('').text(`Minimum Withdrawal Amount ${mwa}`);
                return;
            }
            if (parseFloat(amount) > parseFloat(wa)) {
                $("#clapcanreas").removeClass('d-none').text('').text(`Maximum Withdrawal Amount ${wa}`);
                return;
            }
            $("#clapcanreas").addClass('d-none').text('');
        } else {
            $("#clapcanreas").removeClass('d-none').text('').text(`Minimum Withdrawal Amount ${mwa}`);
        }
    });

    $(document).on('change', '#lwptcid', function(){
        let value = $(this).val()
        $('#lpayment_data').html('')
        if (value == "UPI") {
            $('#lpayment_data').html(
                '<label class="col-form-label">UPI Id</label>'+
                '<input class="form-control dwinc" type="text" name="upi_id" placeholder="Enter UPI Id" required>'
            );
        } else if(value == "Paypal") {
            $('#lpayment_data').html(
                '<label class="col-form-label">Paypal Email Id</label>'+
                '<input class="form-control dwinc" type="text" name="paypal_id" placeholder="Enter Paypal Id" required>'
            ); 
        } else if(value == "BANK Transfer") {
            $('#lpayment_data').html(
                '<label class="col-form-label">Bank Account No</label>'+
                '<input class="form-control dwinc" type="number" name="bank_no" placeholder="Enter Paypal Email Id" required>'+
                '<label class="col-form-label">IFSC Code</label>'+
                '<input class="form-control dwinc" type="text" name="bank_ifsc" placeholder="Enter IFSC Code" required>'+
                '<label class="col-form-label">Bank Account Type</label>'+
                '<input class="form-control dwinc" type="text" name="bank_type" placeholder="Enter Account Type" required>'
            );
        }
    })

    $(document).on('click', '#lwwithbtnc', function(){
        let amount = $(".lwainput").val();
        const { wa, mwa } = $("#lwpareq").data();
        if (parseFloat(wa) >= parseFloat(mwa)) {
            if (parseFloat(amount) < parseFloat(mwa)) {
                $("#clapcanreas").removeClass('d-none').text('').text(`Minimum Withdrawal Amount ${mwa}`);
                return;
            }
            if (parseFloat(amount) > parseFloat(wa)) {
                $("#clapcanreas").removeClass('d-none').text('').text(`Maximum Withdrawal Amount ${wa}`);
                return;
            }
            $("#clapcanreas").addClass('d-none').text('');
            let checki = 0, otherc = 0;
            $(".dwinc").each(function(){
                otherc++;
                if ($(this).val() == 0 || $(this).val() == '' || $(this).val() == null) checki++;
            });
            
            if (checki == 0 && otherc > 2) {    
                $("#detail_error").addClass("d-none");
                $("#lwawform").submit();
            } else {
                $("#detail_error").removeClass("d-none");
            }
        } else {
            $("#clapcanreas").removeClass('d-none').text('').text(`Minimum Withdrawal Amount ${mwa}`);
        }
    });

    $(document).on('click', '#labccatwab', function(){
        const base_url = window.location.origin;
        $.ajax({
            url: base_url + '/lab/lab_cash_wbalance',
            type: 'POST',
            dataType: 'JSON',
            success: function (res){
                if (res.status == true) {
                    $("#lxtcatot").text(res.lab[0].cash_amount);
                    $("#paymentsucc").modal("show");
                    $("#lcabwbtn").attr("data-cab", res.lab[0].cash_amount)
                    currency()
                    thousands_separators()
                }
            }
        });        
    });

    $(document).on('input', '.lcawinput', function(){
        let amount = $(this).val(), casha = $("#lcabwbtn").attr("data-cab");
        if (Number(amount) > Number(casha) || amount == 0 || isNaN(amount)) $("#lcwinperror").removeClass('d-none');
        else $("#lcwinperror").addClass('d-none');
    });

    $(document).on('click', '#lcabwbtn', function(){
        let inpc = 0;
        $(".dwinc").each(function(){
            if ($(this).val() == '' || $(this).val() == 0 || $(this).val() == null) inpc++
        });

        if (inpc == 0) {
            $("#detail_error").addClass("d-none");

            let amount = $("#lwcashimput").val(), casha = $('#lcabwbtn').attr("data-cab");
            if (Number(amount) > Number(casha) || amount == 0 || isNaN(amount)) $("#lcwinperror").removeClass('d-none');
            else {
                $("#lcwinperror").addClass('d-none');
                $("#dwawform").submit();
            }
            
        } else $("#detail_error").removeClass("d-none");
    });


    
    $(document).on('click', '#alcasappro', function(){
        const id = $(this).attr("data-id"), current = $(this).parents(".acashmtr");
        const base_url = window.location.origin;
        $.ajax({
            url: base_url + '/settings/accept_lab_cash',
            type: 'POST',
            dataType: 'JSON',
            data: {id},
            success: function (res){
                if (res.status == true) {
                    current.find(".acasstatus").html('').html(`<span class="badge badge-success">${res.approve}</span>`);
                    current.find(".acasmain").html('-');
                    toastr.success(res.message);
                } else toastr.error(res.message);
            }
        });    
    });

    $(document).on('click', '#alcasateject', function(){
        const id = $(this).attr("data-id"), current = $(this).parents(".acashmtr");
        const base_url = window.location.origin;
        $.ajax({
            url: base_url + '/settings/reject_lab_cash',
            type: 'POST',
            dataType: 'JSON',
            data: {id},
            success: function (res){
                if (res.status == true) {
                    current.find(".acasstatus").html('').html(`<span class="badge badge-danger">${res.reject}</span>`);
                    current.find(".acasmain").html('-');
                    toastr.success(res.message);
                } else toastr.error(res.message);
            }
        });    
    });

    $(document).on('click', '#adcasappro', function(){
        const id = $(this).attr("data-id"), current = $(this).parents(".adcmantr");
        const base_url = window.location.origin;
        $.ajax({
            url: base_url + '/settings/accept_doctor_cash',
            type: 'POST',
            dataType: 'JSON',
            data: {id},
            success: function (res){
                if (res.status == true) {
                    current.find(".acasstatus").html('').html(`<span class="badge badge-success">${res.approve}</span>`);
                    current.find(".acasmain").html('-');
                    toastr.success(res.message);
                } else toastr.error(res.message);
            }
        });    
    });

    $(document).on('click', '#adcasateject', function(){
        const id = $(this).attr("data-id"), current = $(this).parents(".adcmantr");
        const base_url = window.location.origin;
        $.ajax({
            url: base_url + '/settings/reject_doctor_cash',
            type: 'POST',
            dataType: 'JSON',
            data: {id},
            success: function (res){
                if (res.status == true) {
                    current.find(".acasstatus").html('').html(`<span class="badge badge-danger">${res.reject}</span>`);
                    current.find(".acasmain").html('-');
                    toastr.success(res.message);
                } else toastr.error(res.message);
            }
        });    
    });

    $(document).on('click', '#admdocpaybtn', function(){
        let { id } = $(this).data();
        const base_url = window.location.origin;
        $.ajax({
            url: base_url + '/settings/admin_doc_pay_data',
            type: 'POST',
            dataType: 'JSON',
            data: {id},
            success: function (res){
                if (res.status == true) {
                    $("#payment_sid").val(res.pay_list[0].id);
                    $(".pay_img").attr('src', "../images/dashboard/default/profile.png");
                    $("#admpayfile").val('');
                    $("#pay_urp").addClass('d-none');
                    $("#pay_paypal").addClass('d-none');
                    $("#pay_account").addClass('d-none');
                    $(".pay_uname").text('').text(res.pay_list[0].doc_name);
                    $(".pay_uemail").text('').text(res.pay_list[0].doc_email);
                    $(".pay_amount").text('').text(res.pay_list[0].amount);
                    if (res.pay_list[0].p_type == "1") {
                        $("#pay_urp").removeClass('d-none');
                        $(".pupi_data").text('').text(res.pay_list[0].upi_id);
                    }
                    if (res.pay_list[0].p_type == "2") {
                        $("#pay_paypal").removeClass('d-none');
                        $(".ppaypal_data").text('').text(res.pay_list[0].paypal_id);
                    }
                    if (res.pay_list[0].p_type == "3") {
                        $("#pay_account").removeClass('d-none');
                        $(".pbankac_data").text('').text(res.pay_list[0].bank_no);
                        $(".pifsc_data").text('').text(res.pay_list[0].bank_ifsc);
                        $(".pactype_data").text('').text(res.pay_list[0].bank_type);
                    }
                    currency();
                    thousands_separators();
                    $("#adm_payo_mod").modal("show");
                } else toastr.error(res.message);
            }
        });   
    });

    $(document).on('click', '#sbt_aw_pay_doc', function(){
        const file = $("#admpayfile")[0], id = $("#payment_sid").val();
        if (file.files.length > 0) {
            let formData = new FormData();
            formData.append("image", file.files[0]);
            formData.append("id", id);
            const base_url = window.location.origin;
            $.ajax({
                url: base_url + '/settings/add_wpayment',
                type: 'POST',
                data: formData,
                processData: false,
                contentType: false,
                success: function (res){
                    if (res.status == true) {
                        
                        $("#adm_payo_mod").modal("hide");
                        
                        const current = $(`.admpaytr${id}`);
                        current.find(".admpaya").attr("href", `../../${res.imageUrl}`);
                        current.find(".admpayimg").attr("src", `../../${res.imageUrl}`);
                        current.find(".admpaytd").html('').html(`<span class="badge badge-success hand-hover">${res.paid}</span>`);


                        toastr.success(res.message);
                    } else toastr.error(res.message);
                }
            });
        } else toastr.error('Please Upload Image');
    });

    $(document).on('click', '#amediocpaybtn', function(){
        let { id } = $(this).data();
        const base_url = window.location.origin;
        $.ajax({
            url: base_url + '/settings/admin_medicine_pay_data',
            type: 'POST',
            dataType: 'JSON',
            data: {id},
            success: function (res){
                if (res.status == true) {
                    $("#payment_sid").val(res.pay_list[0].id);
                    $(".pay_img").attr('src', "../images/dashboard/default/profile.png");
                    $("#admpayfile").val('');
                    $("#pay_urp").addClass('d-none');
                    $("#pay_paypal").addClass('d-none');
                    $("#pay_account").addClass('d-none');
                    $(".pay_uname").text('').text(res.pay_list[0].doc_name);
                    $(".pay_uemail").text('').text(res.pay_list[0].doc_email);
                    $(".pay_amount").text('').text(res.pay_list[0].amount);
                    if (res.pay_list[0].p_type == "1") {
                        $("#pay_urp").removeClass('d-none');
                        $(".pupi_data").text('').text(res.pay_list[0].upi_id);
                    }
                    if (res.pay_list[0].p_type == "2") {
                        $("#pay_paypal").removeClass('d-none');
                        $(".ppaypal_data").text('').text(res.pay_list[0].paypal_id);
                    }
                    if (res.pay_list[0].p_type == "3") {
                        $("#pay_account").removeClass('d-none');
                        $(".pbankac_data").text('').text(res.pay_list[0].bank_no);
                        $(".pifsc_data").text('').text(res.pay_list[0].bank_ifsc);
                        $(".pactype_data").text('').text(res.pay_list[0].bank_type);
                    }
                    currency();
                    thousands_separators();
                    $("#adm_payo_mod").modal("show");
                } else toastr.error(res.message);
            }
        });   
    });

    $(document).on('click', '#sbt_aw_pay_medi', function(){
        const file = $("#admpayfile")[0], id = $("#payment_sid").val();
        if (file.files.length > 0) {
            let formData = new FormData();
            formData.append("image", file.files[0]);
            formData.append("id", id);
            const base_url = window.location.origin;
            $.ajax({
                url: base_url + '/settings/add_medi_pay_data',
                type: 'POST',
                data: formData,
                processData: false,
                contentType: false,
                success: function (res){
                    if (res.status == true) {
                        $("#adm_payo_mod").modal("hide");
                        const current = $(`.almpaytr${id}`);
                        current.find(".almpaya").attr("href", `../../${res.imageUrl}`);
                        current.find(".almpayimg").attr("src", `../../${res.imageUrl}`);
                        current.find(".almpaytd").html('').html(`<span class="badge badge-success hand-hover">${res.paid}</span>`);
                        toastr.success(res.message);
                    } else toastr.error(res.message);
                }
            });
        } else toastr.error('Please Upload Image');
    });

    $(document).on('click', '#amlabpaybtn', function(){
        let { id } = $(this).data();
        const base_url = window.location.origin;
        $.ajax({
            url: base_url + '/settings/admin_lab_pay_data',
            type: 'POST',
            dataType: 'JSON',
            data: {id},
            success: function (res){
                if (res.status == true) {
                    $("#payment_sid").val(res.pay_list[0].id);
                    $(".pay_img").attr('src', "../images/dashboard/default/profile.png");
                    $("#admpayfile").val('');
                    $("#pay_urp").addClass('d-none');
                    $("#pay_paypal").addClass('d-none');
                    $("#pay_account").addClass('d-none');
                    $(".pay_uname").text('').text(res.pay_list[0].lab_name);
                    $(".pay_uemail").text('').text(res.pay_list[0].lab_email);
                    $(".pay_amount").text('').text(res.pay_list[0].amount);
                    if (res.pay_list[0].p_type == "1") {
                        $("#pay_urp").removeClass('d-none');
                        $(".pupi_data").text('').text(res.pay_list[0].upi_id);
                    }
                    if (res.pay_list[0].p_type == "2") {
                        $("#pay_paypal").removeClass('d-none');
                        $(".ppaypal_data").text('').text(res.pay_list[0].paypal_id);
                    }
                    if (res.pay_list[0].p_type == "3") {
                        $("#pay_account").removeClass('d-none');
                        $(".pbankac_data").text('').text(res.pay_list[0].bank_no);
                        $(".pifsc_data").text('').text(res.pay_list[0].bank_ifsc);
                        $(".pactype_data").text('').text(res.pay_list[0].bank_type);
                    }
                    currency();
                    thousands_separators();
                    $("#adm_payo_mod").modal("show");
                } else toastr.error(res.message);
            }
        });   
    });

    $(document).on('click', '#sbt_aw_pay_lab', function(){
        const file = $("#admpayfile")[0], id = $("#payment_sid").val();
        if (file.files.length > 0) {
            let formData = new FormData();
            formData.append("image", file.files[0]);
            formData.append("id", id);
            const base_url = window.location.origin;
            $.ajax({
                url: base_url + '/settings/add_lab_pay_data',
                type: 'POST',
                data: formData,
                processData: false,
                contentType: false,
                success: function (res){
                    if (res.status == true) {
                        $("#adm_payo_mod").modal("hide");
                        const current = $(`.alampaytr${id}`);
                        current.find(".alampaya").attr("href", `../../${res.imageUrl}`);
                        current.find(".alampayimg").attr("src", `../../${res.imageUrl}`);
                        current.find(".alampaytd").html('').html(`<span class="badge badge-success hand-hover">${res.paid}</span>`);
                        toastr.success(res.message);
                    } else toastr.error(res.message);
                }
            });
        } else toastr.error('Please Upload Image');
    });

    $(document).on('click', '#allwueb', function(){
        let check = 0;
        $(".cain").each(function(){
            if ($(this).val() == '' || $(this).val() == null) check++;
        });

        if (check > 0) $("#details_error").removeClass("d-none");
        else {
            $("#details_error").addClass("d-none");
            $("#email_error").addClass("d-none");
            $("#phone_error").addClass("d-none");
            const form = document.getElementById('ewebuf');
            const formData = new FormData(form);
            const jsonData = {};
            formData.forEach((value, key) => {
                jsonData[key] = value;
            });
            const base_url = window.location.origin;
            $.ajax({
                url: base_url + '/settings/admin_detail_update',
                type: 'POST',
                dataType: 'JSON',
                data: jsonData,
                success: function (res){
                    if (res.status == true) {
                        toastr.success(res.message);
                    } else {
                        if (res.check_email == false) $("#email_error").removeClass("d-none");
                        if (res.check_mobileno == false) $("#phone_error").removeClass("d-none");
                        toastr.error(res.message);
                    }
                }
            });
            
        }
    })

    $(document).on('click', '#allwuedoc', function(){
        let check = 0;
        $(".docin").each(function(){
            if ($(this).val() == '' || $(this).val() == null) check++;
        });
        if (check > 0) $("#details_error").removeClass("d-none");
        else {
            $("#details_error").addClass("d-none");
            $("#email_error").addClass("d-none");
            $("#phone_error").addClass("d-none");
            const form = document.getElementById('wefddoc');
            const formData = new FormData(form);
            const base_url = window.location.origin;
            $.ajax({
                url: base_url + '/settings/doctor_detail_update',
                type: 'POST',
                data: formData,
                processData: false,
                contentType: false,
                dataType: 'JSON',
                success: function (res){
                    if (res.status == true) {
                        toastr.success(res.message);
                    } else {
                        if (res.check_email == false) $("#email_error").removeClass("d-none");
                        toastr.error(res.message);
                    }
                }
            });
            
        }
    })

    $(document).on('click', '#allwuelab', function(){
        if ($(".labinname").val() == '' || $(".labinemail").val() == '') $("#details_error").removeClass("d-none");
        else {
            $("#details_error").addClass("d-none");
            $("#email_error").addClass("d-none");
            $("#phone_error").addClass("d-none");
            const form = document.getElementById('wefdlab');
            const formData = new FormData(form);
            const base_url = window.location.origin;
            $.ajax({
                url: base_url + '/settings/lab_detail_update',
                type: 'POST',
                data: formData,
                processData: false,
                contentType: false,
                dataType: 'JSON',
                success: function (res){
                    if (res.status == true) toastr.success(res.message);
                    else {
                        if (res.check_email == false) $("#email_error").removeClass("d-none");
                        toastr.error(res.message);
                    }
                }
            });
            
        }
    })

    $(document).on('click', '#edit_faq', function(){
        let { id, title, des: description } = $(this).data();

        $("#edit_faq_form").attr("action", '/settings/edit_faq/' + id)
        $("#faq_title").attr("value", title)
        $("#faq_description").val(description)
    })

    $('[id^=gallery_mouse]').hover(function(){
        let image_id = $(this).attr('data-imgid')
        $(".chech_gallery").each(function(){
            $(this).find("#gallery_delete_click").addClass("d-none")
        })
        $(this).find("#gallery_delete_click").removeClass("d-none")
        
    })

    $(document).on("click", '#gallery_delete_click', function(){
        let id = $(this).parents("#gallery_mouse").attr('data-imgid')
        const base_url = window.location.origin;
        $.ajax({
            url: base_url + '/user/delete_gallery',
            type: 'POST',
            dataType: 'JSON',
            data: {id},
            success: function (res){
            if (res.status == true) {
                window.location.reload()
            }
          }
        });
    });

    $(document).on('click', '#add_new_about', function(){
        let index = 1;
        $(".about_id").each(function(){
            let id =  $(this).val(index)
            let current = $(this).parents("#about_title_row")
            current.find(".about_secound_id").each(function(){
                $(this).val(index)
            })
            index++
        })

        $("#add_about").append(
            '<div class="border-3 border-bottom mt-5 pb-4" id="row_sitter_about">'+
                '<div class="col-12">'+
                    '<label class="col-form-label">Heading</label>'+
                    '<input class="form-control about_input" type="text" name="about_heading" value="" placeholder="Enter Description">'+
                '</div>'+
                '<div class="col-12">'+
                    '<label class="col-form-label">Description</label>'+
                    '<textarea class="form-control about_input" name="about_description" style="width: 100%; height: 90px;" required></textarea>'+
                '</div>'+
                '<div class="col-12 text-end mt-2">'+
                    '<button class="btn btn-primary btn-square b-r-6" id="sitter_add_about" type="button" >Add</button>'+
                '</div>'+
                '<div class="" id="about_title_row">'+
                    '<div class="col-12 row" id="add_sitter_service">'+
                        '<div class="col-lg-4 col-md-4 col-sm-12 col-xl-4">'+
                            '<label class="col-form-label">Title</label>'+
                            '<input class="form-control about_title_input" id="about_first_title" name="title" type="text" value="" placeholder="Enter Title" >'+
                            '<input class="about_id" type="number" name="about_id" value="'+index+'" hidden>'+
                        '</div>'+
                        '<div class="col-lg-2 col-md-2 col-sm-12 col-xl-2 d-flex text-center">'+
                            '<div >'+
                                '<button class="btn btn-primary btn-square add_icon_click b-r-10" style="margin-top: 36px;" type="button" data-bs-toggle="modal" data-bs-target="#add_unitmodal">Select Icon</button>'+
                                '<input type="hidden" class="about_icon_input" value="0">'+
                            '</div>'+
                            '<div class="d-flex align-items-end m-l-20">'+
                                '<img id="show_icon" height="45" width="45" src="../images/dashboard/default/profile.png" alt="Image">'+
                                '<input class="about_input" type="hidden" id="icon_input" name="icon" value="">'+
                            '</div>'+
                        '</div>'+
                        '<div class="col-lg-5 col-md-5 col-sm-12 col-xl-5">'+
                            '<label class="col-form-label">Sub Title</label>'+
                            '<input class="form-control about_input" type="text" name="about_subtitle" value="" placeholder="Enter Description">'+
                        '</div>'+
                        '<div class="col-lg-1 col-md-1 col-sm-12 col-xl-1" style="padding-top: 40px;">'+
                            '<a type="button" class="text-danger delete_all_about mx-4"><i class="f-24 fa fa-trash-o"></i></a>'+
                        '</div>'+
                    '</div>'+
                '</div>'+
            '</div>'
        )
    })

    $(document).on('click', '.delete_all_about', function(){
        $(this).parents("#row_sitter_about").remove()
        let index = 1;
        $(".about_id").each(function(){
            let id =  $(this).val(index)
            let current = $(this).parents("#about_title_row")
            current.find(".about_secound_id").each(function(){
                $(this).val(index)
            })
            index++
        })
    })

    $(document).on('click', '#sitter_add_about', function(){
        let current_row = $(this).parents("#row_sitter_about")
        let id = current_row.find(".about_id").val()

        current_row.find("#about_title_row").append(
            '<div class="col-12 row mt-2" id="add_sitter_service">'+
                '<div class="col-lg-4 col-md-4 col-sm-12 col-xl-4">'+
                    '<input class="form-control about_secound_title" type="text" name="title"  value="" placeholder="Enter Title" hidden>'+
                    '<input class="about_secound_id" type="number" name="about_id" value="'+id+'" hidden>'+
                '</div>'+
                '<div class="col-lg-2 col-md-2 col-sm-12 col-xl-2 d-flex text-center">'+
                    '<div >'+
                        '<button class="btn btn-primary btn-square add_icon_click b-r-10" style="margin-top: 36px;" type="button" data-bs-toggle="modal" data-bs-target="#add_unitmodal">Select Icon</button>'+
                        '<input type="hidden" class="about_icon_input" value="0">'+
                    '</div>'+
                    '<div class="d-flex align-items-end m-l-20">'+
                        '<img id="show_icon" height="45" width="45" src="../images/dashboard/default/profile.png" alt="Image">'+
                        '<input class="about_input" type="hidden" id="icon_input" name="icon" value="">'+
                    '</div>'+
                '</div>'+
                '<div class="col-lg-5 col-md-5 col-sm-12 col-xl-5">'+
                    '<label class="col-form-label">Sub Title</label>'+
                    '<input class="form-control about_input" type="text" name="about_subtitle" value="" placeholder="Enter Description">'+
                '</div>'+
                '<div class="col-lg-1 col-md-1 col-sm-12 col-xl-1" style="padding-top: 40px;">'+
                    '<a type="button" class="text-danger delete_about mx-4"><i class="f-24 fa fa-trash-o"></i></a>'+
                '</div>'+
            '</div>'
        )
    })

    $(document).on('click', '.delete_about', function(){
        $(this).parents('#add_sitter_service').remove()
    })

    $(document).on('click', '.add_icon_click', function(){
        let current = $(this).parents("#add_sitter_service")
        current.find(".about_icon_input").val(1)
    })
    
    $(document).on('click', '#about_image_click', function(){
        let icon = $(this).attr("data-icon")
        $(".about_icon_input").each(function(){
            if ($(this).val() == "1") {
                let current = $(this).parents("#add_sitter_service")
                let old_class = current.find("#icon_input").val()
                current.find("#show_icon").attr("src", "../../uploads/about/" + icon)
                current.find("#icon_input").val(icon)
                current.find(".about_icon_input").val(0)
                $("#icon_list_close").click()
            }
        })
    })

    $(document).on('click', '#sitter_about_field_check', function(){
        let input_check = $(".about_input").filter((index, element) => $(element).val() === "").length;
        $(".about_title_input").each(function(){
            let title = $(this).val()
            if (title == "") {
                input_check += parseFloat(1)
            } else {
                let current = $(this).parents("#about_title_row")
                current.find(".about_secound_title").each(function(){
                    $(this).val(title)
                })
            }
        })

        if (input_check != "0" || $(".about_title_input").val() == undefined) {
            $("#sitter_about_detail_error").removeClass('d-none');
        } else {
            $("#sitter_about_detail_error").addClass('d-none');
            $("#shitter_about_form").submit();
        }


    })

    $(document).on("click", '#edit_banner', function(){
        let { id, image, title, subtitle, department } = $(this).data();
        $("#banner_edit_form").attr('action', '/settings/edit_banner/' + id)
        $(".banner_img").attr('src', "../../" + image)
        $("#banner_image").attr('value', image)
        $("#banner_title").attr('value', title)
        $("#banner_subtitle").attr('value', subtitle)
        $("#banner_services").select2().val(department).trigger('change')
    })

    $(document).on("click", '#edit_sitter_faq_model', function(){
        let { id, title, description } = $(this).data();
        $("#sitterfaq_edit_form").attr('action', '/user/edit_faq/' + id)
        $("#sitter_abour_title").attr('value', title)
        $("#sitter_abour_description").val(description)
    })

    $(document).on('click', '#edit_sitter_coupon', function(){
        let { id, title, sub_title, code, min_amount, discount_amount, start_date, end_date } = $(this).data();
        
        $('#coupon_edit_form').attr('action', '/user/edit_coupon/' + id);
        $('#edit_title').attr('value', title);
        $('#edit_subtitle').attr('value', sub_title);
        $('.edit_code').attr('value', code);
        
        let start_date_date = new Date(start_date);
        let start_date_day = (start_date_date.getDate() < 10 ? '0' + parseInt(start_date_date.getDate()) : start_date_date.getDate());
        let start_date_month = (start_date_date.getMonth()+1 < 10 ? '0' + parseInt(start_date_date.getMonth()+1) : start_date_date.getMonth()+1);
        let start_date_year = start_date_date.getFullYear();
        let start_dates = `${start_date_year}-${start_date_month}-${start_date_day}`;
        $('#edit_start').attr('value', start_dates);
  
        let end_date_date = new Date(end_date);
        let end_date_day = (end_date_date.getDate() < 10 ? '0' + parseInt(end_date_date.getDate()) : end_date_date.getDate());
        let end_date_month = (end_date_date.getMonth()+1 < 10 ? '0' + parseInt(end_date_date.getMonth()+1) : end_date_date.getMonth()+1);
        let end_date_year = end_date_date.getFullYear();
        let end_dates = `${end_date_year}-${end_date_month}-${end_date_day}`;
        $('#edit_end').attr('value', end_dates);
  
        $('#edit_minimuma').attr('value', min_amount);
        $('#edit_discounta').attr('value', discount_amount);
    })

    $(".dropbtn").click(function(){
        let dropdowns = document.getElementsByClassName("dropdown-content");
        let i;
        for (i = 0; i < dropdowns.length; i++) {
            let openDropdown = dropdowns[i];
            if (openDropdown.classList.contains('show')) {
  
              openDropdown.classList.remove('show');
            };
        };
  
        let currentRow=$(this).closest(".dropdown");
        currentRow.find(".myDropdown").toggleClass("show");
    });

    window.onclick = function(event) {
        if (!event.target.matches('.dropbtn')) {
            let dropdowns = document.getElementsByClassName("dropdown-content");
            let i;
            for (i = 0; i < dropdowns.length; i++) {
                    let openDropdown = dropdowns[i];
                if (openDropdown.classList.contains('show')) {
                    openDropdown.classList.remove('show');
                };
            };
        };
    };

    $(document).on("change", "#report_d_date", function(){
        let date = $(this).val()
        let sid = $("#report_d_sl").select2().val();
        dailyReport(date, sid)
    })

    $(document).on("change", "#report_d_sl", function(){
        let sid = $(this).select2().val();
        let date = $("#report_d_date").val();
        dailyReport(date, sid);
    })

    function dailyReport(date, sid) {
        let role = $(".role").attr("data-role");
        
        const base_url = window.location.origin;
        $.ajax({
            url: base_url + '/report/daily_data',
            type: 'POST',
            dataType: 'JSON',
            data: {date, sid, role},
            success: function (res){
                if (res.daily_list != "") {
                    const d = res.daily_list;
                    $('#basic-1 tbody tr').each(function (index) {
                        const lastTd = $(this).find('td').last();
                        const Key = Object.keys(d)[index];
                        lastTd.text(d[Key]);
                    });
                }
            }
        }); 
    }

    $(document).on("change", "#rsbooksitter", function(){
        let user = $(this).select2().val();
        let start = $("#rsbookstart").val();
        let end = $("#rsbookend").val();
        let status = $("#rsbookstatus").select2().val();
        let role = $(".role").attr('data-role');
        bookserviceReport(user, start, end, status, role);
    })

    $(document).on("change", "#rsbookstart", function(){
        let user = $("#rsbooksitter").select2().val();
        let start = $(this).val();
        let end = $("#rsbookend").val();
        let status = $("#rsbookstatus").select2().val();
        let role = $(".role").attr('data-role');
        bookserviceReport(user, start, end, status, role);
    })

    $(document).on("change", "#rsbookend", function(){
        let user = $("#rsbooksitter").select2().val();
        let start = $("#rsbookstart").val();
        let end = $(this).val();
        let status = $("#rsbookstatus").select2().val();
        let role = $(".role").attr('data-role');
        bookserviceReport(user, start, end, status, role);
    })

    $(document).on("change", "#rsbookstatus", function(){
        let user = $("#rsbooksitter").select2().val();
        let start = $("#rsbookstart").val();
        let end = $("#rsbookend").val();
        let status = $(this).select2().val();
        let role = $(".role").attr('data-role');
        bookserviceReport(user, start, end, status, role);
    })

    function bookserviceReport(user, start, end, status, role) {
        const base_url = window.location.origin;
        $.ajax({
            url: base_url + '/report/sbook_service',
            type: 'POST',
            dataType: 'JSON',
            data: {user, start, end, status, role},
            success: function (res){
                $("#service_report").html("")
                let data = ""
                if ($.fn.DataTable.isDataTable('#basic-1')) {
                    $('#basic-1').DataTable().destroy();
                }
                
                if (role == 1) {
                    $.each(res.services, function(i, v){
                        data += `<tr>
                                    <td class="d-none"></td>
                                    <td>#${v.id}</td>
                                    <td>${v.cus_name}</td>
                                    <td>${v.doctor_name}</td>
                                    <td>${v.service_name}</td>
                                    <td class="invosymbol">${v.tot_price}</td>
                                    <td>${v.date}</td>
                                    <td>
                                        <span class="${v.status_type.b} px-3 py-1 b-r-5 f-14 f-w-400">${v.status_type.s}</span>
                                    </td>
                                </tr>`
                    });
                    
                } else if (role == 2) {
                    $.each(res.services, function(i, v){
                        data += `<tr>
                                    <td class="d-none"></td>
                                    <td>#${v.id}</td>
                                    <td>${v.cus_name}</td>
                                    <td>${v.doctor_name}</td>
                                    <td class="invosymbol">${v.tot_price}</td>
                                    <td>${v.date}</td>
                                    <td>
                                        <span class="${v.status_type.b} px-3 py-1 b-r-5 f-14 f-w-400">${v.status_type.s}</span>
                                    </td>
                                </tr>`
                    });
                    
                } else if (role == 3) {
                    $.each(res.services, function(i, v){
                        data += `<tr>
                                     <td class="d-none"></td>
                                     <td>#${v.id}</td>
                                     <td>${v.cus_name}</td>
                                     <td>${v.lab_name}</td>
                                     <td>${v.category_name}</td>
                                     <td class="invosymbol">${v.tot_price}</td>
                                     <td>${v.date}</td>
                                     <td>
                                         <span class="${v.status_type.b} px-3 py-1 b-r-5 f-14 f-w-400">${v.status_type.s}</span>
                                     </td>
                                 </tr>`
                    });
                    
                }
                $("#service_report").html(data);
                $('#basic-1').DataTable({ "responsive": true, "paging": true, "searching": true, "info": true });
                $("#dbookr").text("").text(res.torder);
    
                currency();
                thousands_separators();
            }
        }); 
    }

    $(document).on("click", "#dbookreport", function(){
        let sitter = $("#rsbooksitter").select2().val();
        let start = $("#rsbookstart").val();
        let end = $("#rsbookend").val();
        let status = $("#rsbookstatus").select2().val();
        let role = $(".role").attr('data-role');
        const base_url = window.location.origin;
        $.ajax({
            url: base_url + '/report/dbook',
            type: 'POST',
            dataType: 'JSON',
            data: {sitter, start, end, status, role},
            success: function (res){
            }
        }); 
    })

    $(document).on("change", "#rcomstart", function(){
        let start = $(this).val();
        let end = $("#rcomkend").val();
        let sitter = $("#rcomsitter").select2().val();
        let role = $(".role").attr('data-role');
        ecommission(start, end, sitter, role);
    })

    $(document).on("change", "#rcomkend", function(){
        let start = $("#rcomstart").val();
        let end = $(this).val();
        let sitter = $("#rcomsitter").select2().val();
        let role = $(".role").attr('data-role');
        ecommission(start, end, sitter, role);
    })

    $(document).on("change", "#rcomsitter", function(){
        let start = $("#rcomstart").val();
        let end = $("#rcomkend").val();
        let sitter = $(this).select2().val();
        let role = $(".role").attr('data-role');
        ecommission(start, end, sitter, role);
    })

    function ecommission(start, end, sitter, role) {
        const base_url = window.location.origin;
        $.ajax({
            url: base_url + '/report/scommission',
            type: 'POST',
            dataType: 'JSON',
            data: {start, end, sitter, role},
            success: function (res){
                $("#commission_report").html("");
                if ($.fn.DataTable.isDataTable('#basic-1')) {
                    $('#basic-1').DataTable().destroy();
                }
                let data = ""
                if (res.allservices != "") {
                    $.each(res.allservices, function(i, v){
                        data += `<tr>
                                    <td class="d-none"></td>
                                    <td>#${v.id}</td>
                                    ${res.admin_role == 1 ? `<td class="invosymbol">${v.site_comi}</td>` : ''}
                                    <td class="invosymbol">${v.doc_comi}</td>
                                    <td class="invosymbol">${v.tot_price}</td>
                                    <td>${v.date}</td>
                                    <td>${v.cus_name}</td>
                                    <td>${v.doc_name}</td>
                                </tr>`
                    });            
                }

                $("#commission_report").html(data);
                $('#basic-1').DataTable({ "responsive": true, "paging": true, "searching": true, "info": true });

                $("#rctotal").text("").text(res.totservice);
                $("#rcsite").text("").text(parseFloat(res.sitecom).toFixed(2));
                $("#rcsitter").text("").text(parseFloat(res.usercom).toFixed(2));

                currency();
                thousands_separators();

            }
        }); 
    }

    $(document).on("click", "#dcommissionr", function(){
        let start = $("#rcomstart").val()
        let end = $("#rcomkend").val()
        let sitter = $("#rcomsitter").select2().val()
        let role = $(".role").attr('data-role');
        const base_url = window.location.origin;
        $.ajax({
            url: base_url + '/report/dcommreport',
            type: 'POST',
            dataType: 'JSON',
            data: {start, end, sitter},
            success: function (res){
            }
        }); 
    })

    $(document).on("change", "#rpsitter", function(){
        let sitter = $(this).select2().val();
        let start = $("#rpstart").val();
        let end = $("#rpend").val();
        let status = $("#rpstatus").select2().val();
        let role = $(".role").attr('data-role');
        payoutRport(sitter, start, end, status, role)
    })

    $(document).on("change", "#rpstart", function(){
        let sitter = $("#rpsitter").select2().val();
        let start = $(this).val();
        let end = $("#rpend").val();
        let status = $("#rpstatus").select2().val();
        let role = $(".role").attr('data-role');
        payoutRport(sitter, start, end, status, role)
    })

    $(document).on("change", "#rpend", function(){
        let sitter = $("#rpsitter").select2().val();
        let start = $("#rpstart").val();
        let end = $(this).val();
        let status = $("#rpstatus").select2().val();
        let role = $(".role").attr('data-role');
        payoutRport(sitter, start, end, status, role)
    })

    $(document).on("change", "#rpstatus", function(){
        let sitter = $("#rpsitter").select2().val();
        let start = $("#rpstart").val();
        let end = $("#rpend").val();
        let status = $(this).select2().val();
        let role = $(".role").attr('data-role');
        payoutRport(sitter, start, end, status, role)
    })

    function payoutRport(sitter, start, end, status, role) {
        const base_url = window.location.origin;
        $.ajax({
            url: base_url + '/report/payout_data',
            type: 'POST',
            dataType: 'JSON',
            data: {sitter, start, end, status, role},
            success: function (res){
                $("#payout_report").html("");
                let data = ""
                if (res.allservices != "") {

                    $.each(res.allservices, function(i, v){

                        data += `<tr>
                                    <td class="d-none"></td>
                                    <td>${v.date}</td>
                                    <td class="invosymbol">${v.amount}</td>
                                    <td>${v.user_name}</td>
                                    <td>${v.user_email}</td>
                                    <td>
                                        <span class="px-3 py-1 b-r-5 f-14 f-w-400">${ v.p_type == 1 ? 'UPI' : ( v.p_type == 2 ? 'Paypal' : 'Bank Transfer' ) }</span>
                                    </td>
                                    <td>
                                        <span class="${ v.p_status == 1 ? 'btn-success' : 'btn-secondary' } px-3 py-1 b-r-5 f-14 f-w-400">${ v.p_status == 1 ? 'Successful' : 'Pending' }</span>
                                    </td>
                                </tr>`;
                    });                                   
                }

                if ($.fn.DataTable.isDataTable('#basic-1')) {
                    $('#basic-1').DataTable().destroy();
                }
                $("#payout_report").html(data)
                $('#basic-1').DataTable({ "responsive": true, "paging": true, "searching": true, "info": true });

                $("#prrotal").text("").text(res.ptotal)
                $("#prcomplete").text("").text(res.sitecom)
                $("#prpending").text("").text(res.usercom)

                currency()
                thousands_separators()
            }
        }); 
    }

    $(document).on("click", "#dpayputreport", function(){
        let sitter = $("#rpsitter").select2().val()
        let start = $("#rpstart").val()
        let end = $("#rpend").val()
        let status = $("#rpstatus").select2().val()
        const base_url = window.location.origin;
        $.ajax({
            url: base_url + '/report/dpayout',
            type: 'POST',
            dataType: 'JSON',
            data: {sitter, start, end, status},
            success: function (res){
            }
        }); 
    })
    
    $(document).on("click", "#printdata", function(){
        let content = document.getElementById("printcontent").innerHTML;
        document.body.innerHTML = content;
        window.print();
        location.reload();
    })
    
    $(document).on("click", "#adnseallus", function(){ $(this).siblings("#selecttype").attr("checked", true); });

    $(document).on("click", "#adnselus", function(){ $(this).siblings("#selecttype").attr("checked", true); });
    
    $(document).on("change", ".selecttype", function(){
        if( $(this).val() == "2" ) $("#notiuser").removeClass("d-none");
        else $("#notiuser").addClass("d-none");
    })
    
    $(document).on("change", "#ancusall", function(){
        if ($("#ancus").select2().val() != null) {
            $("#ancus").select2().val('').trigger('change')
            $("#ancusall").prop("checked", true);
        }
    });

    $(document).on("change", "#ancus", function(){
        $("#ancusall").prop("checked", false);
    });

    $(document).on("click", "#ancusallcus", function(){
        if ($("#ancus").select2().val() != null) {
            $("#ancus").select2().val('').trigger('change')
            $("#ancusall").prop("checked", true);
        } else $("#ancusall").is(":checked") ? $("#ancusall").prop("checked", false) : $("#ancusall").prop("checked", true);
    });
    
    $(document).on("change", "#andocall", function(){
        if ($("#andoc").select2().val() != null) {
            $("#andoc").select2().val('').trigger('change')
            $("#andocall").prop("checked", true);
        }
    });

    $(document).on("change", "#andoc", function(){
        $("#andocall").prop("checked", false);
    });

    $(document).on("click", "#ancusalldoc", function(){
        if ($("#andoc").select2().val() != null) {
            $("#andoc").select2().val('').trigger('change')
            $("#andocall").prop("checked", true);
        } else $("#andocall").is(":checked") ? $("#andocall").prop("checked", false) : $("#andocall").prop("checked", true);
    });
    
    $(document).on("change", "#anlaball", function(){
        if ($("#anlab").select2().val() != null) {
            $("#anlab").select2().val('').trigger('change')
            $("#anlaball").prop("checked", true);
        }
    });

    $(document).on("change", "#anlab", function(){
        $("#anlaball").prop("checked", false);
    });

    $(document).on("click", "#ancusalllab", function(){
        if ($("#anlab").select2().val() != null) {
            $("#anlab").select2().val('').trigger('change')
            $("#anlaball").prop("checked", true);
        } else $("#anlaball").is(":checked") ? $("#anlaball").prop("checked", false) : $("#anlaball").prop("checked", true);
    });

    $(document).on("click", "#notificatio_btn", function(){
        if ($(".ncheckd").val() == "") {
            $("#send_all").removeClass("d-none");
        } else {
            if ($('.selecttype').is(":checked") === false) {
                $("#send_all").removeClass("d-none");
            } else {
                let stype = $("input[name='selecttype']:checked").val();
                if (stype == "2") {
                    let check = 0;
                    $(".cnofids").each(function(){
                        if ($(this).select2().val() != null) {
                            check++;
                        }
                    });
                    $(".cnofid").each(function(){
                        if ($(this).is(":checked")) {
                            check++;
                        }
                    });
                    if (check > 0) {
                        $("#send_all").addClass("d-none");
                        $("#sendnform").submit()
                    } else $("#send_all").removeClass("d-none");
                } else if (stype == "1") {
                    $("#send_all").addClass("d-none")
                    $("#sendnform").submit()
                }
            }
        }
    })

    $(document).on("click", "#role_fbtn", function(){
        let check = 0, checkbox = 0
        $(".checkin").each(function(){
            if($(this).val() == "" || $(this).val() == null) check += 1
        });

        $(".checkinc").each(function(){
            if ($(this).is(":checked")) checkbox++;
        });

        if (check != "0" || checkbox == 0) $("#detail_error").removeClass("d-none");
        else {
            $("#detail_error").addClass("d-none");
            const base_url = window.location.origin;
            $.ajax({
                url: base_url + '/role/detail_check',
                type: 'POST',
                dataType: 'JSON',
                data: {email: $("#role_email").val(), country: $("#role_countrycode").select2().val(), phone: $("#role_phone").val()},
                success: function (res){
                    if (res.check_email == false) $("#detail_email_error").removeClass("d-none");
                    if (res.check_mobileno == false) $("#detail_phone_error").removeClass("d-none");

                    if (res.check_email == true && res.check_mobileno == true) {
                        $("#detail_email_error").addClass("d-none");
                        $("#detail_phone_error").addClass("d-none");
                        $("#role_form").submit();
                    }
                }
            });    
        }
    })

    $(document).on("click", '#edit_role_fbtn', function(){
        let check = 0, checkbox = 0
        $(".checkin").each(function(){
            if($(this).val() == "" || $(this).val() == null) check += 1
        });

        $(".checkinc").each(function(){
            if ($(this).is(":checked")) checkbox++;
        });

        if (check != "0" || checkbox == 0) $("#detail_error").removeClass("d-none");
        else {
            $("#detail_error").addClass("d-none");
            const base_url = window.location.origin;

            const email = $("#erole_email").val() != $("#orole_email").val() ? $("#erole_email").val() : '';
            const country = $("#erole_countrycode").val() != $("#orole_ccode").val() || $("#erole_phone").val() != $("#orole_phone").val() ? $("#erole_countrycode").val() : '';
            const phone = $("#erole_countrycode").val() != $("#orole_ccode").val() || $("#erole_phone").val() != $("#orole_phone").val() ? $("#erole_phone").val() : '';

            $.ajax({
                url: base_url + '/role/detail_check',
                type: 'POST',
                dataType: 'JSON',
                data: { email, country, phone},
                success: function (res){
                    if (res.check_email == false) $("#detail_email_error").removeClass("d-none");
                    if (res.check_mobileno == false) $("#detail_phone_error").removeClass("d-none");

                    if (res.check_email == true && res.check_mobileno == true) {
                        $("#detail_email_error").addClass("d-none");
                        $("#detail_phone_error").addClass("d-none");
                        $("#erole_form").submit();
                    }
                }
            });    
        }

        
    
    })

    $(document).on("click", "#edit_new_product", function(){
        const file = event.target.files[0];
        const z = document.getElementById(`videoPreview${num}`)
        const fileURL = URL.createObjectURL(file);
    })

    $(document).on("click", "#delete_pimage", function(){
        const imgval = $(this).parents('#main_pimage');
        const check = imgval.find(".img_check_p").val();

        if (check != 'newimage') {
            const base_url = window.location.origin;
            $.ajax({
                url: base_url + '/user/delete_pro_image',
                type: 'POST',
                dataType: 'JSON',
                data: {id: $("#prod_id").val(), img: imgval.find("#del_img_val").val()},
                success: function (res){
                    if (res.status == true) {
                        imgval.remove();
                        toastr.success('Image Delete successfully');
                    } else toastr.error('Image Not Found!');
                }
            });
        } else {
            imgval.remove();
        }
    })

    $(document).on("change", "#pimage_input", function(event){
        const imgval = $(this).parents('#main_pimage');
        const check = imgval.find(".img_check_p").val();
        if (check != 'newimage') {
            const base_url = window.location.origin;
            $.ajax({
                url: base_url + '/user/delete_pro_image',
                type: 'POST',
                dataType: 'JSON',
                data: {id: $("#prod_id").val(), img: imgval.find("#del_img_val").val()},
                success: function (res){
                    if (res.status == true) {
                        const file = event.target.files[0];
                        const fileURL = URL.createObjectURL(file);
                        imgval.find("#show_pimage").attr('src', fileURL);
                        imgval.find(".img_check_p").val("newimage");
                        toastr.success('Image Delete successfully');
                    } else toastr.error('Image Not Found!');
                }
            });
        } else {
            const file = event.target.files[0];
            const fileURL = URL.createObjectURL(file);
            imgval.find("#show_pimage").attr('src', fileURL);
            imgval.find(".img_check_p").val("newimage");
        }
    })

    $(document).on("click", "#add_other_image", function(event){
        const data = '<div class="col-lg-2 col-md-6 col-sm-12 col-xl-2 form-group" id="main_pimage">'+
                        '<img class="m-2 p-1" id="show_pimage" width="150" height="150" src="../../images/dashboard/default/profile.png" alt="image">'+
                        '<div class="d-flex">'+
                            '<input class="form-control" id="pimage_input" style="height: 48px;" type="file" name="image" accept="image/*" required>'+
                            '<input class="img_check_p" type="hidden" id="del_img_val" value="">'+
                            '<i class="m-l-10 f-18 icon-trash mt-3" id="delete_pimage" style="color: red;"></i>'+
                        '</div>'+
                      '</div>'

        $("#image-grid").append(data);
    });

    $(document).on("click", "#add_other_himage", function(event){
        const data = '<div class="col-lg-2 col-md-6 col-sm-12 col-xl-2 form-group" id="main_pimage">'+
                        '<img class="m-2 p-1" id="show_pimage" width="150" height="150" src="../../images/dashboard/default/profile.png" alt="image">'+
                        '<div class="d-flex">'+
                            '<input class="form-control" id="pimage_hinput" style="height: 48px;" type="file" name="image" accept="image/*" required>'+
                            '<input class="img_check_p" type="hidden" id="del_img_val" value="">'+
                            '<i class="m-l-10 f-18 icon-trash mt-3" id="delete_himage" style="color: red;"></i>'+
                        '</div>'+
                      '</div>'

        $("#image-grid").append(data);
    })

    $(document).on("change", "#pimage_hinput", function(event){
        const imgval = $(this).parents('#main_pimage');
        const check = imgval.find(".img_check_p").val();
        if (check != 'newimage') {
            const base_url = window.location.origin;
            $.ajax({
                url: base_url + '/hospital/delete_hospital_image',
                type: 'POST',
                dataType: 'JSON',
                data: {id: $("#hos_id").val(), img: imgval.find("#del_img_val").val()},
                success: function (res){
                    if (res.status == true) {
                        const file = event.target.files[0];
                        const fileURL = URL.createObjectURL(file);
                        imgval.find("#show_pimage").attr('src', fileURL);
                        imgval.find(".img_check_p").val("newimage");
                        toastr.success('Image Delete successfully');
                    } else toastr.error('Image Not Found!');
                }
            });
        } else {
            const file = event.target.files[0];
            const fileURL = URL.createObjectURL(file);
            imgval.find("#show_pimage").attr('src', fileURL);
            imgval.find(".img_check_p").val("newimage");
        }
    })

    $(document).on("click", "#delete_himage", function(){
        const imgval = $(this).parents('#main_pimage');
        const check = imgval.find(".img_check_p").val();

        if (check != 'newimage') {
            const base_url = window.location.origin;
            $.ajax({
                url: base_url + '/hospital/delete_hospital_image',
                type: 'POST',
                dataType: 'JSON',
                data: {id: $("#hos_id").val(), img: imgval.find("#del_img_val").val()},
                success: function (res){
                    if (res.status == true) {
                        imgval.remove();
                        toastr.success('Image Delete successfully');
                    } else toastr.error('Image Not Found!');
                }
            });
        } else {
            imgval.remove();
        }
    })

    $(document).on("click", "#edit_product", function(){
        let imgcheck = 0, check = 0
        $(".img_check_p").each(function(){
            if($(this).val() == "" || $(this).val() == null) check += 1;
            imgcheck += 1
        })
        $(".img_check").each(function(){
            if($(this).val() == "" || $(this).val() == null) check += 1;
        })

        if (check != 0 || imgcheck == 0) $("#sitter_pet_detail").removeClass("d-none")
        else {
            $("#sitter_pet_detail").addClass("d-none")
            $("#edit_pro_form").submit();
        }
    })

    $(document).on("click", "#bedit", function(){
        const current_row = $(this).parents('.mainsbimg');
        const bimg = current_row.find('.edbanner');
        bimg.html('');
        bimg.html('<div class="m-1">'+
                        '<form class="needs-validation upbing" enctype="multipart/form-data">'+
                            '<input class="form-control biminput" type="file" name="image" accept="image/*" required>'+
                            '<input type="hidden" name="biuid" value="'+ $(this).data('biuid') +'">'+
                            '<div class="d-flex align-content-center justify-content-center mt-1">'+
                                '<button class="btn btn-primary btn-square b-r-10 ebbtn" data-biuid="'+ $(this).data('biuid') +'" style="padding: 4px 10px;" type="submit">'+ $(this).data('edit') +'</button>'+
                                '<a><i class="m-l-10 fa fa-times removebibtn" data-biuid="'+ $(this).data('biuid') +'" data-edit="'+ $(this).data('edit') +'"></i></a>'+
                            '</div>'+
                        '</form>'+
                    '</div>');
    })

    $(document).on("click", ".removebibtn", function(){
        const current_row = $(this).parents('.mainsbimg');
        const bimg = current_row.find('.edbanner');
        bimg.html('');
        bimg.html('<div class="edit"><a id="bedit" data-biuid="'+ $(this).data('biuid') +'" data-edit="'+ $(this).data('edit') +'"><i class="f-18 icon-pencil-alt"></i></a></div>'+
                    '<div class="delete"><a id="dbimage" data-biuid="'+ $(this).data('biuid') +'" data-edit="'+ $(this).data('edit') +'"><i class="f-18 icon-trash"></i></a></div>');

    })

    $(document).on("change", ".biminput", function(event){
        const current_row = $(this).parents('.mainsbimg');
        const file = event.target.files[0];
        const fileURL = URL.createObjectURL(file);
        current_row.find(".showbimg").attr('src', fileURL);
    })

    $(document).on("submit", ".upbing", function(e){
        e.preventDefault();
        const current_row = $(this).parents('.mainsbimg');
        
        const bimg = new FormData(this);
        const base_url = window.location.origin;
        $.ajax({
            url: base_url + '/user/edit_sub_banner',
            type: 'POST',
            data: bimg,
            processData: false, contentType: false,
            success: function (res){
                if (res.status == true) {
                    toastr.success('Image update successful');
                    const bimg = current_row.find('.edbanner');
                    bimg.html('');
                    bimg.html('<div class="edit"><a id="bedit" data-biuid="'+ res.biuid +'" data-edit="'+ res.edit +'"><i class="f-18 icon-pencil-alt"></i></a></div>'+
                                '<div class="delete"><a id="dbimage" data-biuid="'+ res.biuid +'" data-edit="'+ res.edit +'"><i class="f-18 icon-trash"></i></a></div>');
                } else toastr.error('Something went wrong');
            }
        });
    })

    $(document).on("click", "#dbimage", function(){
        const current_row = $(this).parents('.mainsbimg');
        
        const base_url = window.location.origin;
        $.ajax({
            url: base_url + '/user/delete_sub_banner',
            type: 'POST',
            dataType: 'JSON',
            data: {biuid: $(this).data('biuid')},
            success: function (res){
                if (res.status == true) {
                    if (res.c == 1) {
                        toastr.success('Image delete successful');
                        current_row.remove();
                    } else {
                        $("#allbid").html('');
                        $("#allbid").html('<div class="row" id="allbdata">'+
                                                '<h5>'+ res.bnf +'!</h5>'+
                                            '</div>');
                    }
                } else toastr.error('Something went wrong');
            }
        });
    })

    if ($('#davidtimer').length) {
        startCountdown();
    }
    
currency();
thousands_separators();
})

$(document).on('click', '#gen_code', function () {
    $('#coupon_code').val(makeid(6));
    return false;
});

function formatTime(seconds) {
    let hrs = String(Math.floor(seconds / 3600)).padStart(2, '0');
    let mins = String(Math.floor((seconds % 3600) / 60)).padStart(2, '0');
    let secs = String(seconds % 60).padStart(2, '0');
    return hrs + ':' + mins + ':' + secs;
}

function startCountdown() {
    let $timer = $('#davidtimer');
    let totalSeconds = parseInt($timer.data('times'), 10);

    let timerInterval = setInterval(function () {
        if (totalSeconds <= 0) {
            clearInterval(timerInterval);
            $("#dvadatamd").remove();
            return;
        }

        $timer.text(formatTime(totalSeconds));
        totalSeconds--;
    }, 1000);
}

function makeid(length) {
    let result = '';
    let characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
    let charactersLength = characters.length;
    for (let i = 0; i < length; i++) {
        result += characters.charAt(Math.floor(Math.random() * charactersLength));
    }
    return result;
}

function showPreview(event) {
    if (event.target.files.length > 0) {
        let src = URL.createObjectURL(event.target.files[0]);
        let preview = document.getElementById("file-preview");
        preview.src = src;
    };
};

function secondshowPreview(event) {
    if (event.target.files.length > 0) {
        let src = URL.createObjectURL(event.target.files[0]);
        let preview = document.getElementById("second-file-preview");
        preview.src = src;
    };
};

function currency(){
    let sym = $('#rate_sym').val()
    let pls = $('#rate_pla').val()
  
    if(pls == 1){
        let users = document.getElementsByClassName('invosymbol');
        let user_length = users.length
        for (let i = 0; i < user_length; ++i) {
            let user = users[i];
          
            if (user.innerHTML.indexOf(sym) > -1){

                user.innerHTML =  user.innerHTML +' ';
            } else {
                user.innerHTML =  user.innerHTML +' '+ sym;
            }
        }
    }else{
        let users = document.getElementsByClassName('invosymbol');
        let user_length = users.length
        for (let i = 0; i < user_length; ++i) {
            let user = users[i];

            if (user.innerHTML.indexOf(sym) > -1) {

                user.innerHTML = ' '+ user.innerHTML;
            } else {
                user.innerHTML = sym +' '+ user.innerHTML;
            }
        }
    }  
}

function thousands_separators(){
    let thousands_replace = $('#thousand_replace').val()
    let num = document.getElementsByClassName("invosymbol")
  
    let separator;
    if (thousands_replace == '1') {
      separator = ','
    } else if (thousands_replace == '2') {
      separator = '.'
    } else if (thousands_replace == '3') {
      separator = '`'
    } else if (thousands_replace == '4') {
      separator = ''
    } else {
      separator = ' '
    }
  
    let num_length = num.length
    for (let i = 0; i < num_length; ++i) {
        let val = num[i]
        let data = val.innerHTML
        let num_parts = data.toString().split(".");
        num_parts[0] = num_parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, separator);
        
        val.innerHTML = num_parts.join(".")
    }
}

function showListPreview(event) {
    const previewContainer = document.getElementById("file-preview-container");
    previewContainer.innerHTML = ""; 

    const files = event.target.files;
    for (let i = 0; i < files.length; i++) {
        let src = URL.createObjectURL(files[i]);
        let img = document.createElement("img");
        img.src = src;
        img.width = 150;
        img.height = 150;
        img.className = "m-2 p-1";
        img.alt = `Preview ${i + 1}`;
        img.style.border = "1px solid grey";
        img.style.borderRadius = "6px";
        previewContainer.appendChild(img);
    }
};
</script>